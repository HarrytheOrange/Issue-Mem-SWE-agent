+ source /opt/miniconda3/bin/activate
++ _CONDA_ROOT=/opt/miniconda3
++ . /opt/miniconda3/etc/profile.d/conda.sh
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ '[' -z '' ']'
+++ export CONDA_SHLVL=0
+++ CONDA_SHLVL=0
+++ '[' -n '' ']'
+++++ dirname /opt/miniconda3/bin/conda
++++ dirname /opt/miniconda3/bin
+++ PATH=/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ export PATH
+++ '[' -z '' ']'
+++ PS1=
++ conda activate
++ local cmd=activate
++ case "$cmd" in
++ __conda_activate activate
++ '[' -n '' ']'
++ local ask_conda
+++ PS1=
+++ __conda_exe shell.posix activate
+++ /opt/miniconda3/bin/conda shell.posix activate
++ ask_conda='PS1='''(base) '''
export PATH='''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3'''
export CONDA_SHLVL='''1'''
export CONDA_DEFAULT_ENV='''base'''
export CONDA_PROMPT_MODIFIER='''(base) '''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python''''
++ eval 'PS1='''(base) '''
export PATH='''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3'''
export CONDA_SHLVL='''1'''
export CONDA_DEFAULT_ENV='''base'''
export CONDA_PROMPT_MODIFIER='''(base) '''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python''''
+++ PS1='(base) '
+++ export PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ export CONDA_PREFIX=/opt/miniconda3
+++ CONDA_PREFIX=/opt/miniconda3
+++ export CONDA_SHLVL=1
+++ CONDA_SHLVL=1
+++ export CONDA_DEFAULT_ENV=base
+++ CONDA_DEFAULT_ENV=base
+++ export 'CONDA_PROMPT_MODIFIER=(base) '
+++ CONDA_PROMPT_MODIFIER='(base) '
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ __conda_hashr
++ '[' -n '' ']'
++ '[' -n '' ']'
++ hash -r
+ conda activate testbed
+ local cmd=activate
+ case "$cmd" in
+ __conda_activate activate testbed
+ '[' -n '' ']'
+ local ask_conda
++ PS1='(base) '
++ __conda_exe shell.posix activate testbed
++ /opt/miniconda3/bin/conda shell.posix activate testbed
+ ask_conda='PS1='''(testbed) '''
export PATH='''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3/envs/testbed'''
export CONDA_SHLVL='''2'''
export CONDA_DEFAULT_ENV='''testbed'''
export CONDA_PROMPT_MODIFIER='''(testbed) '''
export CONDA_PREFIX_1='''/opt/miniconda3'''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python'''
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libglib_activate.sh"
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libxml2_activate.sh"'
+ eval 'PS1='''(testbed) '''
export PATH='''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3/envs/testbed'''
export CONDA_SHLVL='''2'''
export CONDA_DEFAULT_ENV='''testbed'''
export CONDA_PROMPT_MODIFIER='''(testbed) '''
export CONDA_PREFIX_1='''/opt/miniconda3'''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python'''
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libglib_activate.sh"
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libxml2_activate.sh"'
++ PS1='(testbed) '
++ export PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ export CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ export CONDA_SHLVL=2
++ CONDA_SHLVL=2
++ export CONDA_DEFAULT_ENV=testbed
++ CONDA_DEFAULT_ENV=testbed
++ export 'CONDA_PROMPT_MODIFIER=(testbed) '
++ CONDA_PROMPT_MODIFIER='(testbed) '
++ export CONDA_PREFIX_1=/opt/miniconda3
++ CONDA_PREFIX_1=/opt/miniconda3
++ export CONDA_EXE=/opt/miniconda3/bin/conda
++ CONDA_EXE=/opt/miniconda3/bin/conda
++ export _CE_M=
++ _CE_M=
++ export _CE_CONDA=
++ _CE_CONDA=
++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ . /opt/miniconda3/envs/testbed/etc/conda/activate.d/libglib_activate.sh
+++ export GSETTINGS_SCHEMA_DIR_CONDA_BACKUP=
+++ GSETTINGS_SCHEMA_DIR_CONDA_BACKUP=
+++ export GSETTINGS_SCHEMA_DIR=/opt/miniconda3/envs/testbed/share/glib-2.0/schemas
+++ GSETTINGS_SCHEMA_DIR=/opt/miniconda3/envs/testbed/share/glib-2.0/schemas
++ . /opt/miniconda3/envs/testbed/etc/conda/activate.d/libxml2_activate.sh
+++ test -n ''
+++ xml_catalog_files_libxml2=
+++ XML_CATALOG_FILES=
+++ conda_catalog_files=
+++ ifs_libxml2=' 	
'
+++ IFS=' '
+++ rem=/opt/miniconda3/envs/testbed
+++ for pre in ${rem}
+++ test '' = /opt/miniconda3/envs/testbed
+++ conda_catalog_files=/opt/miniconda3/envs/testbed
+++ rem=
+++ IFS=' 	
'
+++ conda_catalog_files='file:///opt/miniconda3/envs/testbed/etc/xml/catalog file:///etc/xml/catalog'
+++ export 'XML_CATALOG_FILES=file:///opt/miniconda3/envs/testbed/etc/xml/catalog file:///etc/xml/catalog'
+++ XML_CATALOG_FILES='file:///opt/miniconda3/envs/testbed/etc/xml/catalog file:///etc/xml/catalog'
+++ unset conda_catalog_files ifs_libxml2 rem
+ __conda_hashr
+ '[' -n '' ']'
+ '[' -n '' ']'
+ hash -r
+ cd /testbed
+ git config --global --add safe.directory /testbed
+ cd /testbed
+ git status
On branch main
Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
	modified:   lib/matplotlib/figure.py
	deleted:    setup.py
	deleted:    setupext.py

no changes added to commit (use "git add" and/or "git commit -a")
+ git show
commit 1d0d255b79e84dfc9f2123c5eb85a842d342f72b
Merge: 623da30bae ba602101ba
Author: Kyle Sunden <git@ksunden.space>
Date:   Fri Jun 23 13:00:34 2023 -0500

    Merge pull request #26154 from tacaswell/fix/py312_itertools
    
    MNT: py312 deprecates pickling objects in itertools

+ git -c core.fileMode=false diff 1d0d255b79e84dfc9f2123c5eb85a842d342f72b
diff --git a/lib/matplotlib/figure.py b/lib/matplotlib/figure.py
index dab2bc4a5a..fb37e55991 100644
--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -2272,19 +2272,14 @@ class SubFigure(FigureBase):
             self.bbox_relative.p0 = bbox.p0
             self.bbox_relative.p1 = bbox.p1
             return
-        # need to figure out *where* this subplotspec is.
-        gs = self._subplotspec.get_gridspec()
-        wr = np.asarray(gs.get_width_ratios())
-        hr = np.asarray(gs.get_height_ratios())
-        dx = wr[self._subplotspec.colspan].sum() / wr.sum()
-        dy = hr[self._subplotspec.rowspan].sum() / hr.sum()
-        x0 = wr[:self._subplotspec.colspan.start].sum() / wr.sum()
-        y0 = 1 - hr[:self._subplotspec.rowspan.stop].sum() / hr.sum()
+        # Use the subplotspec's get_position method which properly accounts
+        # for spacing (wspace, hspace) and other subplot parameters
+        bbox = self._subplotspec.get_position(self.figure)
         if self.bbox_relative is None:
-            self.bbox_relative = Bbox.from_bounds(x0, y0, dx, dy)
+            self.bbox_relative = bbox
         else:
-            self.bbox_relative.p0 = (x0, y0)
-            self.bbox_relative.p1 = (x0 + dx, y0 + dy)
+            self.bbox_relative.p0 = bbox.p0
+            self.bbox_relative.p1 = bbox.p1
 
     def get_constrained_layout(self):
         """
diff --git a/setup.py b/setup.py
deleted file mode 100644
index cbde743847..0000000000
--- a/setup.py
+++ /dev/null
@@ -1,356 +0,0 @@
-"""
-The Matplotlib build options can be modified with a mplsetup.cfg file. See
-mplsetup.cfg.template for more information.
-"""
-
-# NOTE: This file must remain Python 2 compatible for the foreseeable future,
-# to ensure that we error out properly for people with outdated setuptools
-# and/or pip.
-import sys
-
-py_min_version = (3, 9)  # minimal supported python version
-since_mpl_version = (3, 8)  # py_min_version is required since this mpl version
-
-if sys.version_info < py_min_version:
-    error = """
-Beginning with Matplotlib {0}, Python {1} or above is required.
-You are using Python {2}.
-
-This may be due to an out of date pip.
-
-Make sure you have pip >= 9.0.1.
-""".format('.'.join(str(n) for n in since_mpl_version),
-           '.'.join(str(n) for n in py_min_version),
-           '.'.join(str(n) for n in sys.version_info[:3]))
-    sys.exit(error)
-
-import os
-from pathlib import Path
-import shutil
-import subprocess
-
-from setuptools import setup, find_namespace_packages, Distribution, Extension
-import setuptools.command.build_ext
-import setuptools.command.build_py
-import setuptools.command.sdist
-
-# sys.path modified to find setupext.py during pyproject.toml builds.
-sys.path.append(str(Path(__file__).resolve().parent))
-
-import setupext
-from setupext import print_raw, print_status
-
-
-# These are the packages in the order we want to display them.
-mpl_packages = [
-    setupext.Matplotlib(),
-    setupext.Python(),
-    setupext.Platform(),
-    setupext.FreeType(),
-    setupext.Qhull(),
-    setupext.Tests(),
-    setupext.BackendMacOSX(),
-    ]
-
-
-# From https://bugs.python.org/issue26689
-def has_flag(self, flagname):
-    """Return whether a flag name is supported on the specified compiler."""
-    import tempfile
-    with tempfile.NamedTemporaryFile('w', suffix='.cpp') as f:
-        f.write('int main (int argc, char **argv) { return 0; }')
-        try:
-            self.compile([f.name], extra_postargs=[flagname])
-        except Exception as exc:
-            # https://github.com/pypa/setuptools/issues/2698
-            if type(exc).__name__ != "CompileError":
-                raise
-            return False
-    return True
-
-
-class BuildExtraLibraries(setuptools.command.build_ext.build_ext):
-    def finalize_options(self):
-        # If coverage is enabled then need to keep the .o and .gcno files in a
-        # non-temporary directory otherwise coverage info not collected.
-        cppflags = os.getenv('CPPFLAGS')
-        if cppflags and '--coverage' in cppflags:
-            self.build_temp = 'build'
-
-        self.distribution.ext_modules[:] = [
-            ext
-            for package in good_packages
-            for ext in package.get_extensions()
-        ]
-        super().finalize_options()
-
-    def add_optimization_flags(self):
-        """
-        Add optional optimization flags to extension.
-
-        This adds flags for LTO and hidden visibility to both compiled
-        extensions, and to the environment variables so that vendored libraries
-        will also use them. If the compiler does not support these flags, then
-        none are added.
-        """
-
-        env = os.environ.copy()
-        if sys.platform == 'win32':
-            return env
-        enable_lto = setupext.config.getboolean('libs', 'enable_lto',
-                                                fallback=None)
-
-        def prepare_flags(name, enable_lto):
-            """
-            Prepare *FLAGS from the environment.
-
-            If set, return them, and also check whether LTO is disabled in each
-            one, raising an error if Matplotlib config explicitly enabled LTO.
-            """
-            if name in os.environ:
-                if '-fno-lto' in os.environ[name]:
-                    if enable_lto is True:
-                        raise ValueError('Configuration enable_lto=True, but '
-                                         '{0} contains -fno-lto'.format(name))
-                    enable_lto = False
-                return [os.environ[name]], enable_lto
-            return [], enable_lto
-
-        _, enable_lto = prepare_flags('CFLAGS', enable_lto)  # Only check lto.
-        cppflags, enable_lto = prepare_flags('CPPFLAGS', enable_lto)
-        cxxflags, enable_lto = prepare_flags('CXXFLAGS', enable_lto)
-        ldflags, enable_lto = prepare_flags('LDFLAGS', enable_lto)
-
-        if enable_lto is False:
-            return env
-
-        if has_flag(self.compiler, '-fvisibility=hidden'):
-            for ext in self.extensions:
-                ext.extra_compile_args.append('-fvisibility=hidden')
-            cppflags.append('-fvisibility=hidden')
-        if has_flag(self.compiler, '-fvisibility-inlines-hidden'):
-            for ext in self.extensions:
-                if self.compiler.detect_language(ext.sources) != 'cpp':
-                    continue
-                ext.extra_compile_args.append('-fvisibility-inlines-hidden')
-            cxxflags.append('-fvisibility-inlines-hidden')
-        ranlib = 'RANLIB' in env
-        if not ranlib and self.compiler.compiler_type == 'unix':
-            try:
-                result = subprocess.run(self.compiler.compiler +
-                                        ['--version'],
-                                        stdout=subprocess.PIPE,
-                                        stderr=subprocess.STDOUT,
-                                        universal_newlines=True)
-            except Exception:
-                pass
-            else:
-                version = result.stdout.lower()
-                if 'gcc' in version:
-                    ranlib = shutil.which('gcc-ranlib')
-                elif 'clang' in version:
-                    if sys.platform == 'darwin':
-                        ranlib = True
-                    else:
-                        ranlib = shutil.which('llvm-ranlib')
-        if ranlib and has_flag(self.compiler, '-flto'):
-            for ext in self.extensions:
-                ext.extra_compile_args.append('-flto')
-            cppflags.append('-flto')
-            ldflags.append('-flto')
-            # Needed so FreeType static library doesn't lose its LTO objects.
-            if isinstance(ranlib, str):
-                env['RANLIB'] = ranlib
-
-        env['CPPFLAGS'] = ' '.join(cppflags)
-        env['CXXFLAGS'] = ' '.join(cxxflags)
-        env['LDFLAGS'] = ' '.join(ldflags)
-
-        return env
-
-    def build_extensions(self):
-        if (self.compiler.compiler_type == 'msvc' and
-                os.environ.get('MPL_DISABLE_FH4')):
-            # Disable FH4 Exception Handling implementation so that we don't
-            # require VCRUNTIME140_1.dll. For more details, see:
-            # https://devblogs.microsoft.com/cppblog/making-cpp-exception-handling-smaller-x64/
-            # https://github.com/joerick/cibuildwheel/issues/423#issuecomment-677763904
-            for ext in self.extensions:
-                ext.extra_compile_args.append('/d2FH4-')
-
-        env = self.add_optimization_flags()
-        for package in good_packages:
-            package.do_custom_build(env)
-        return super().build_extensions()
-
-    def build_extension(self, ext):
-        # When C coverage is enabled, the path to the object file is saved.
-        # Since we re-use source files in multiple extensions, libgcov will
-        # complain at runtime that it is trying to save coverage for the same
-        # object file at different timestamps (since each source is compiled
-        # again for each extension). Thus, we need to use unique temporary
-        # build directories to store object files for each extension.
-        orig_build_temp = self.build_temp
-        self.build_temp = os.path.join(self.build_temp, ext.name)
-        try:
-            super().build_extension(ext)
-        finally:
-            self.build_temp = orig_build_temp
-
-
-def update_matplotlibrc(path):
-    # If packagers want to change the default backend, insert a `#backend: ...`
-    # line.  Otherwise, use the default `##backend: Agg` which has no effect
-    # even after decommenting, which allows _auto_backend_sentinel to be filled
-    # in at import time.
-    template_lines = path.read_text(encoding="utf-8").splitlines(True)
-    backend_line_idx, = [  # Also asserts that there is a single such line.
-        idx for idx, line in enumerate(template_lines)
-        if "#backend:" in line]
-    template_lines[backend_line_idx] = (
-        "#backend: {}
".format(setupext.options["backend"])
-        if setupext.options["backend"]
-        else "##backend: Agg
")
-    path.write_text("".join(template_lines), encoding="utf-8")
-
-
-class BuildPy(setuptools.command.build_py.build_py):
-    def run(self):
-        super().run()
-        if not getattr(self, 'editable_mode', False):
-            update_matplotlibrc(
-                Path(self.build_lib, "matplotlib/mpl-data/matplotlibrc"))
-
-
-class Sdist(setuptools.command.sdist.sdist):
-    def make_release_tree(self, base_dir, files):
-        super().make_release_tree(base_dir, files)
-        update_matplotlibrc(
-            Path(base_dir, "lib/matplotlib/mpl-data/matplotlibrc"))
-
-# Start with type hint data
-# Will be further filled below by the various components.
-package_data = {"matplotlib": ["py.typed", "**/*.pyi"]}
-
-# If the user just queries for information, don't bother figuring out which
-# packages to build or install.
-if not (any('--' + opt in sys.argv
-            for opt in Distribution.display_option_names + ['help'])
-        or 'clean' in sys.argv):
-    # Go through all of the packages and figure out which ones we are
-    # going to build/install.
-    print_raw()
-    print_raw("Edit mplsetup.cfg to change the build options; "
-              "suppress output with --quiet.")
-    print_raw()
-    print_raw("BUILDING MATPLOTLIB")
-
-    good_packages = []
-    for package in mpl_packages:
-        try:
-            message = package.check()
-        except setupext.Skipped as e:
-            print_status(package.name, "no  [{e}]".format(e=e))
-            continue
-        if message is not None:
-            print_status(package.name,
-                         "yes [{message}]".format(message=message))
-        good_packages.append(package)
-
-    print_raw()
-
-    # Now collect all of the information we need to build all of the packages.
-    for package in good_packages:
-        # Extension modules only get added in build_ext, as numpy will have
-        # been installed (as setup_requires) at that point.
-        data = package.get_package_data()
-        for key, val in data.items():
-            package_data.setdefault(key, [])
-            package_data[key] = list(set(val + package_data[key]))
-
-setup(  # Finally, pass this all along to setuptools to do the heavy lifting.
-    name="matplotlib",
-    description="Python plotting package",
-    author="John D. Hunter, Michael Droettboom",
-    author_email="matplotlib-users@python.org",
-    url="https://matplotlib.org",
-    download_url="https://matplotlib.org/stable/users/installing/index.html",
-    project_urls={
-        'Documentation': 'https://matplotlib.org',
-        'Source Code': 'https://github.com/matplotlib/matplotlib',
-        'Bug Tracker': 'https://github.com/matplotlib/matplotlib/issues',
-        'Forum': 'https://discourse.matplotlib.org/',
-        'Donate': 'https://numfocus.org/donate-to-matplotlib'
-    },
-    long_description=Path("README.md").read_text(encoding="utf-8"),
-    long_description_content_type="text/markdown",
-    license="PSF",
-    platforms="any",
-    classifiers=[
-        'Development Status :: 5 - Production/Stable',
-        'Framework :: Matplotlib',
-        'Intended Audience :: Science/Research',
-        'Intended Audience :: Education',
-        'License :: OSI Approved :: Python Software Foundation License',
-        'Programming Language :: Python',
-        'Programming Language :: Python :: 3',
-        'Programming Language :: Python :: 3.9',
-        'Programming Language :: Python :: 3.10',
-        'Programming Language :: Python :: 3.11',
-        'Topic :: Scientific/Engineering :: Visualization',
-    ],
-
-    package_dir={"": "lib"},
-    packages=find_namespace_packages(
-        where="lib",
-        exclude=["*baseline_images*", "*tinypages*", "*mpl-data*", "*web_backend*"],
-    ),
-    py_modules=["pylab"],
-    # Dummy extension to trigger build_ext, which will swap it out with
-    # real extensions that can depend on numpy for the build.
-    ext_modules=[Extension("", [])],
-    package_data=package_data,
-
-    python_requires='>={}'.format('.'.join(str(n) for n in py_min_version)),
-    # When updating the list of dependencies, add an api_changes/development
-    # entry and also update the following places:
-    # - lib/matplotlib/__init__.py (matplotlib._check_versions())
-    # - requirements/testing/minver.txt
-    # - doc/devel/dependencies.rst
-    # - .github/workflows/tests.yml
-    # - environment.yml
-    install_requires=[
-        "contourpy>=1.0.1",
-        "cycler>=0.10",
-        "fonttools>=4.22.0",
-        "kiwisolver>=1.0.1",
-        "numpy>=1.21",
-        "packaging>=20.0",
-        "pillow>=6.2.0",
-        "pyparsing>=2.3.1,<3.1",
-        "python-dateutil>=2.7",
-    ] + (
-        # Installing from a git checkout that is not producing a wheel.
-        ["setuptools_scm>=7"] if (
-            Path(__file__).with_name(".git").exists() and
-            os.environ.get("CIBUILDWHEEL", "0") != "1"
-        ) else []
-    ),
-    extras_require={
-        ':python_version<"3.10"': [
-            "importlib-resources>=3.2.0",
-        ],
-    },
-    use_scm_version={
-        "version_scheme": "release-branch-semver",
-        "local_scheme": "node-and-date",
-        "write_to": "lib/matplotlib/_version.py",
-        "parentdir_prefix_version": "matplotlib-",
-        "fallback_version": "0.0+UNKNOWN",
-    },
-    cmdclass={
-        "build_ext": BuildExtraLibraries,
-        "build_py": BuildPy,
-        "sdist": Sdist,
-    },
-)
diff --git a/setupext.py b/setupext.py
deleted file mode 100644
index a91c681e0f..0000000000
--- a/setupext.py
+++ /dev/null
@@ -1,796 +0,0 @@
-import configparser
-import functools
-import hashlib
-from io import BytesIO
-import logging
-import os
-from pathlib import Path
-import platform
-import shlex
-import shutil
-import subprocess
-import sys
-import sysconfig
-import tarfile
-from tempfile import TemporaryDirectory
-import textwrap
-import urllib.request
-
-from pybind11.setup_helpers import Pybind11Extension
-from setuptools import Distribution, Extension
-
-_log = logging.getLogger(__name__)
-
-
-def _get_xdg_cache_dir():
-    """
-    Return the `XDG cache directory`__.
-
-    __ https://specifications.freedesktop.org/basedir-spec/latest/
-    """
-    cache_dir = os.environ.get('XDG_CACHE_HOME')
-    if not cache_dir:
-        cache_dir = os.path.expanduser('~/.cache')
-        if cache_dir.startswith('~/'):  # Expansion failed.
-            return None
-    return Path(cache_dir, 'matplotlib')
-
-
-def _get_hash(data):
-    """Compute the sha256 hash of *data*."""
-    hasher = hashlib.sha256()
-    hasher.update(data)
-    return hasher.hexdigest()
-
-
-@functools.cache
-def _get_ssl_context():
-    import certifi
-    import ssl
-    return ssl.create_default_context(cafile=certifi.where())
-
-
-def get_from_cache_or_download(url, sha):
-    """
-    Get bytes from the given url or local cache.
-
-    Parameters
-    ----------
-    url : str
-        The url to download.
-    sha : str
-        The sha256 of the file.
-
-    Returns
-    -------
-    BytesIO
-        The file loaded into memory.
-    """
-    cache_dir = _get_xdg_cache_dir()
-
-    if cache_dir is not None:  # Try to read from cache.
-        try:
-            data = (cache_dir / sha).read_bytes()
-        except OSError:
-            pass
-        else:
-            if _get_hash(data) == sha:
-                return BytesIO(data)
-
-    # jQueryUI's website blocks direct downloads from urllib.request's
-    # default User-Agent, but not (for example) wget; so I don't feel too
-    # bad passing in an empty User-Agent.
-    with urllib.request.urlopen(
-            urllib.request.Request(url, headers={"User-Agent": ""}),
-            context=_get_ssl_context()) as req:
-        data = req.read()
-
-    file_sha = _get_hash(data)
-    if file_sha != sha:
-        raise Exception(
-            f"The downloaded file does not match the expected sha.  {url} was "
-            f"expected to have {sha} but it had {file_sha}")
-
-    if cache_dir is not None:  # Try to cache the downloaded file.
-        try:
-            cache_dir.mkdir(parents=True, exist_ok=True)
-            with open(cache_dir / sha, "xb") as fout:
-                fout.write(data)
-        except OSError:
-            pass
-
-    return BytesIO(data)
-
-
-def get_and_extract_tarball(urls, sha, dirname):
-    """
-    Obtain a tarball (from cache or download) and extract it.
-
-    Parameters
-    ----------
-    urls : list[str]
-        URLs from which download is attempted (in order of attempt), if the
-        tarball is not in the cache yet.
-    sha : str
-        SHA256 hash of the tarball; used both as a cache key (by
-        `get_from_cache_or_download`) and to validate a downloaded tarball.
-    dirname : path-like
-        Directory where the tarball is extracted.
-    """
-    toplevel = Path("build", dirname)
-    if not toplevel.exists():  # Download it or load it from cache.
-        try:
-            import certifi  # noqa
-        except ImportError as e:
-            raise ImportError(
-                f"`certifi` is unavailable ({e}) so unable to download any of "
-                f"the following: {urls}.") from None
-
-        Path("build").mkdir(exist_ok=True)
-        for url in urls:
-            try:
-                tar_contents = get_from_cache_or_download(url, sha)
-                break
-            except Exception:
-                pass
-        else:
-            raise OSError(
-                f"Failed to download any of the following: {urls}.  "
-                f"Please download one of these urls and extract it into "
-                f"'build/' at the top-level of the source repository.")
-        print(f"Extracting {urllib.parse.urlparse(url).path}")
-        with tarfile.open(fileobj=tar_contents, mode="r:gz") as tgz:
-            if os.path.commonpath(tgz.getnames()) != dirname:
-                raise OSError(
-                    f"The downloaded tgz file was expected to have {dirname} "
-                    f"as sole top-level directory, but that is not the case")
-            tgz.extractall("build")
-    return toplevel
-
-
-# SHA256 hashes of the FreeType tarballs
-_freetype_hashes = {
-    '2.6.1':
-        '0a3c7dfbda6da1e8fce29232e8e96d987ababbbf71ebc8c75659e4132c367014',
-    '2.6.2':
-        '8da42fc4904e600be4b692555ae1dcbf532897da9c5b9fb5ebd3758c77e5c2d4',
-    '2.6.3':
-        '7942096c40ee6fea882bd4207667ad3f24bff568b96b10fd3885e11a7baad9a3',
-    '2.6.4':
-        '27f0e38347a1850ad57f84fc4dfed68ba0bc30c96a6fa6138ef84d485dd9a8d7',
-    '2.6.5':
-        '3bb24add9b9ec53636a63ea8e867ed978c4f8fdd8f1fa5ccfd41171163d4249a',
-    '2.7':
-        '7b657d5f872b0ab56461f3bd310bd1c5ec64619bd15f0d8e08282d494d9cfea4',
-    '2.7.1':
-        '162ef25aa64480b1189cdb261228e6c5c44f212aac4b4621e28cf2157efb59f5',
-    '2.8':
-        '33a28fabac471891d0523033e99c0005b95e5618dc8ffa7fa47f9dadcacb1c9b',
-    '2.8.1':
-        '876711d064a6a1bd74beb18dd37f219af26100f72daaebd2d86cb493d7cd7ec6',
-    '2.9':
-        'bf380e4d7c4f3b5b1c1a7b2bf3abb967bda5e9ab480d0df656e0e08c5019c5e6',
-    '2.9.1':
-        'ec391504e55498adceb30baceebd147a6e963f636eb617424bcfc47a169898ce',
-    '2.10.0':
-        '955e17244e9b38adb0c98df66abb50467312e6bb70eac07e49ce6bd1a20e809a',
-    '2.10.1':
-        '3a60d391fd579440561bf0e7f31af2222bc610ad6ce4d9d7bd2165bca8669110',
-    '2.11.1':
-        'f8db94d307e9c54961b39a1cc799a67d46681480696ed72ecf78d4473770f09b'
-}
-# This is the version of FreeType to use when building a local version.  It
-# must match the value in lib/matplotlib.__init__.py, and the cache path in
-# `.circleci/config.yml`.
-TESTING_VERSION_OF_FREETYPE = '2.6.1'
-if sys.platform.startswith('win') and platform.machine() == 'ARM64':
-    # older versions of freetype are not supported for win/arm64
-    # Matplotlib tests will not pass
-    LOCAL_FREETYPE_VERSION = '2.11.1'
-else:
-    LOCAL_FREETYPE_VERSION = TESTING_VERSION_OF_FREETYPE
-
-LOCAL_FREETYPE_HASH = _freetype_hashes.get(LOCAL_FREETYPE_VERSION, 'unknown')
-
-# Also update the cache path in `.circleci/config.yml`.
-LOCAL_QHULL_VERSION = '2020.2'
-LOCAL_QHULL_HASH = (
-    'b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e')
-
-
-# Matplotlib build options, which can be altered using mplsetup.cfg
-mplsetup_cfg = os.environ.get('MPLSETUPCFG') or 'mplsetup.cfg'
-config = configparser.ConfigParser()
-if os.path.exists(mplsetup_cfg):
-    config.read(mplsetup_cfg)
-options = {
-    'backend': config.get('rc_options', 'backend', fallback=None),
-    'system_freetype': config.getboolean(
-        'libs', 'system_freetype',
-        fallback=sys.platform.startswith(('aix', 'os400'))
-    ),
-    'system_qhull': config.getboolean(
-        'libs', 'system_qhull', fallback=sys.platform.startswith('os400')
-    ),
-}
-
-
-if '-q' in sys.argv or '--quiet' in sys.argv:
-    def print_raw(*args, **kwargs): pass  # Suppress our own output.
-else:
-    print_raw = print
-
-
-def print_status(package, status):
-    initial_indent = "%12s: " % package
-    indent = ' ' * 18
-    print_raw(textwrap.fill(status, width=80,
-                            initial_indent=initial_indent,
-                            subsequent_indent=indent))
-
-
-@functools.cache  # We only need to compute this once.
-def get_pkg_config():
-    """
-    Get path to pkg-config and set up the PKG_CONFIG environment variable.
-    """
-    if sys.platform == 'win32':
-        return None
-    pkg_config = os.environ.get('PKG_CONFIG') or 'pkg-config'
-    if shutil.which(pkg_config) is None:
-        print(
-            "IMPORTANT WARNING:
"
-            "    pkg-config is not installed.
"
-            "    Matplotlib may not be able to find some of its dependencies.")
-        return None
-    pkg_config_path = sysconfig.get_config_var('LIBDIR')
-    if pkg_config_path is not None:
-        pkg_config_path = os.path.join(pkg_config_path, 'pkgconfig')
-        try:
-            os.environ['PKG_CONFIG_PATH'] += ':' + pkg_config_path
-        except KeyError:
-            os.environ['PKG_CONFIG_PATH'] = pkg_config_path
-    return pkg_config
-
-
-def pkg_config_setup_extension(
-        ext, package,
-        atleast_version=None, alt_exec=None, default_libraries=()):
-    """Add parameters to the given *ext* for the given *package*."""
-
-    # First, try to get the flags from pkg-config.
-
-    pkg_config = get_pkg_config()
-    cmd = [pkg_config, package] if pkg_config else alt_exec
-    if cmd is not None:
-        try:
-            if pkg_config and atleast_version:
-                subprocess.check_call(
-                    [*cmd, f"--atleast-version={atleast_version}"])
-            # Use sys.getfilesystemencoding() to allow round-tripping
-            # when passed back to later subprocess calls; do not use
-            # locale.getpreferredencoding() which universal_newlines=True
-            # would do.
-            cflags = shlex.split(
-                os.fsdecode(subprocess.check_output([*cmd, "--cflags"])))
-            libs = shlex.split(
-                os.fsdecode(subprocess.check_output([*cmd, "--libs"])))
-        except (OSError, subprocess.CalledProcessError):
-            pass
-        else:
-            ext.extra_compile_args.extend(cflags)
-            ext.extra_link_args.extend(libs)
-            return
-
-    # If that fails, fall back on the defaults.
-
-    # conda Windows header and library paths.
-    # https://github.com/conda/conda/issues/2312 re: getting the env dir.
-    if sys.platform == 'win32':
-        conda_env_path = (os.getenv('CONDA_PREFIX')  # conda >= 4.1
-                          or os.getenv('CONDA_DEFAULT_ENV'))  # conda < 4.1
-        if conda_env_path and os.path.isdir(conda_env_path):
-            conda_env_path = Path(conda_env_path)
-            ext.include_dirs.append(str(conda_env_path / "Library/include"))
-            ext.library_dirs.append(str(conda_env_path / "Library/lib"))
-
-    # Default linked libs.
-    ext.libraries.extend(default_libraries)
-
-
-class Skipped(Exception):
-    """
-    Exception thrown by `SetupPackage.check` to indicate that a package should
-    be skipped.
-    """
-
-
-class SetupPackage:
-
-    def check(self):
-        """
-        If the package should be installed, return an informative string, or
-        None if no information should be displayed at all.
-
-        If the package should be skipped, raise a `Skipped` exception.
-
-        If a missing build dependency is fatal, call `sys.exit`.
-        """
-
-    def get_package_data(self):
-        """
-        Get a package data dictionary to add to the configuration.
-        These are merged into to the *package_data* list passed to
-        `setuptools.setup`.
-        """
-        return {}
-
-    def get_extensions(self):
-        """
-        Return or yield a list of C extensions (`distutils.core.Extension`
-        objects) to add to the configuration.  These are added to the
-        *extensions* list passed to `setuptools.setup`.
-        """
-        return []
-
-    def do_custom_build(self, env):
-        """
-        If a package needs to do extra custom things, such as building a
-        third-party library, before building an extension, it should
-        override this method.
-        """
-
-
-class OptionalPackage(SetupPackage):
-    default_config = True
-
-    def check(self):
-        """
-        Check whether ``mplsetup.cfg`` requests this package to be installed.
-
-        May be overridden by subclasses for additional checks.
-        """
-        if config.getboolean("packages", self.name,
-                             fallback=self.default_config):
-            return "installing"
-        else:  # Configuration opt-out by user
-            raise Skipped("skipping due to configuration")
-
-
-class Platform(SetupPackage):
-    name = "platform"
-
-    def check(self):
-        return sys.platform
-
-
-class Python(SetupPackage):
-    name = "python"
-
-    def check(self):
-        return sys.version
-
-
-def _pkg_data_helper(pkg, subdir):
-    """Glob "lib/$pkg/$subdir/**/*", returning paths relative to "lib/$pkg"."""
-    base = Path("lib", pkg)
-    return [str(path.relative_to(base)) for path in (base / subdir).rglob("*")]
-
-
-class Matplotlib(SetupPackage):
-    name = "matplotlib"
-
-    def get_package_data(self):
-        return {
-            'matplotlib': [
-                'mpl-data/matplotlibrc',
-                *_pkg_data_helper('matplotlib', 'mpl-data'),
-                *_pkg_data_helper('matplotlib', 'backends/web_backend'),
-                '*.dll',  # Only actually matters on Windows.
-            ],
-        }
-
-    def get_extensions(self):
-        # agg
-        ext = Extension(
-            "matplotlib.backends._backend_agg", [
-                "src/py_converters.cpp",
-                "src/_backend_agg.cpp",
-                "src/_backend_agg_wrapper.cpp",
-            ])
-        add_numpy_flags(ext)
-        add_libagg_flags_and_sources(ext)
-        FreeType.add_flags(ext)
-        yield ext
-        # c_internal_utils
-        ext = Extension(
-            "matplotlib._c_internal_utils", ["src/_c_internal_utils.c"],
-            libraries=({
-                "linux": ["dl"],
-                "win32": ["ole32", "shell32", "user32"],
-            }.get(sys.platform, [])))
-        yield ext
-        # ft2font
-        ext = Extension(
-            "matplotlib.ft2font", [
-                "src/ft2font.cpp",
-                "src/ft2font_wrapper.cpp",
-                "src/py_converters.cpp",
-            ])
-        FreeType.add_flags(ext)
-        add_numpy_flags(ext)
-        add_libagg_flags(ext)
-        yield ext
-        # image
-        ext = Extension(
-            "matplotlib._image", [
-                "src/_image_wrapper.cpp",
-                "src/py_converters.cpp",
-            ])
-        add_numpy_flags(ext)
-        add_libagg_flags_and_sources(ext)
-        yield ext
-        # path
-        ext = Extension(
-            "matplotlib._path", [
-                "src/py_converters.cpp",
-                "src/_path_wrapper.cpp",
-            ])
-        add_numpy_flags(ext)
-        add_libagg_flags_and_sources(ext)
-        yield ext
-        # qhull
-        ext = Extension(
-            "matplotlib._qhull", ["src/_qhull_wrapper.cpp"],
-            define_macros=[("MPL_DEVNULL", os.devnull)])
-        add_numpy_flags(ext)
-        Qhull.add_flags(ext)
-        yield ext
-        # tkagg
-        ext = Extension(
-            "matplotlib.backends._tkagg", [
-                "src/_tkagg.cpp",
-            ],
-            include_dirs=["src"],
-            # psapi library needed for finding Tcl/Tk at run time.
-            libraries={"linux": ["dl"], "win32": ["comctl32", "psapi"],
-                       "cygwin": ["comctl32", "psapi"]}.get(sys.platform, []),
-            extra_link_args={"win32": ["-mwindows"]}.get(sys.platform, []))
-        add_numpy_flags(ext)
-        add_libagg_flags(ext)
-        yield ext
-        # tri
-        ext = Pybind11Extension(
-            "matplotlib._tri", [
-                "src/tri/_tri.cpp",
-                "src/tri/_tri_wrapper.cpp",
-            ],
-            cxx_std=11)
-        yield ext
-        # ttconv
-        ext = Pybind11Extension(
-            "matplotlib._ttconv", [
-                "src/_ttconv.cpp",
-                "extern/ttconv/pprdrv_tt.cpp",
-                "extern/ttconv/pprdrv_tt2.cpp",
-                "extern/ttconv/ttutil.cpp",
-            ],
-            include_dirs=["extern"],
-            cxx_std=11)
-        yield ext
-
-
-class Tests(OptionalPackage):
-    name = "tests"
-    default_config = False
-
-    def get_package_data(self):
-        return {
-            'matplotlib': [
-                *_pkg_data_helper('matplotlib', 'tests/baseline_images'),
-                *_pkg_data_helper('matplotlib', 'tests/tinypages'),
-                'tests/cmr10.pfb',
-                'tests/Courier10PitchBT-Bold.pfb',
-                'tests/mpltest.ttf',
-                'tests/test_*.ipynb',
-            ],
-            'mpl_toolkits': [
-                *_pkg_data_helper('mpl_toolkits',
-                                  'axes_grid1/tests/baseline_images'),
-                *_pkg_data_helper('mpl_toolkits',
-                                  'axisartist/tests/baseline_images'),
-                *_pkg_data_helper('mpl_toolkits',
-                                  'mplot3d/tests/baseline_images'),
-            ]
-        }
-
-
-def add_numpy_flags(ext):
-    import numpy as np
-    ext.include_dirs.append(np.get_include())
-    ext.define_macros.extend([
-        # Ensure that PY_ARRAY_UNIQUE_SYMBOL is uniquely defined for each
-        # extension.
-        ('PY_ARRAY_UNIQUE_SYMBOL',
-         'MPL_' + ext.name.replace('.', '_') + '_ARRAY_API'),
-        ('NPY_NO_DEPRECATED_API', 'NPY_1_7_API_VERSION'),
-        # Allow NumPy's printf format specifiers in C++.
-        ('__STDC_FORMAT_MACROS', 1),
-    ])
-
-
-def add_libagg_flags(ext):
-    # We need a patched Agg not available elsewhere, so always use the vendored
-    # version.
-    ext.include_dirs.insert(0, "extern/agg24-svn/include")
-
-
-def add_libagg_flags_and_sources(ext):
-    # We need a patched Agg not available elsewhere, so always use the vendored
-    # version.
-    ext.include_dirs.insert(0, "extern/agg24-svn/include")
-    agg_sources = [
-        "agg_bezier_arc.cpp",
-        "agg_curves.cpp",
-        "agg_image_filters.cpp",
-        "agg_trans_affine.cpp",
-        "agg_vcgen_contour.cpp",
-        "agg_vcgen_dash.cpp",
-        "agg_vcgen_stroke.cpp",
-        "agg_vpgen_segmentator.cpp",
-    ]
-    ext.sources.extend(
-        os.path.join("extern", "agg24-svn", "src", x) for x in agg_sources)
-
-
-def get_ccompiler():
-    """
-    Return a new CCompiler instance.
-
-    CCompiler used to be constructible via `distutils.ccompiler.new_compiler`,
-    but this API was removed as part of the distutils deprecation.  Instead,
-    we trick setuptools into instantiating it by creating a dummy Distribution
-    with a list of extension modules that claims to be truthy, but is actually
-    empty, and then running the Distribution's build_ext command.  (If using
-    a plain empty ext_modules, build_ext would early-return without doing
-    anything.)
-    """
-
-    class L(list):
-        def __bool__(self):
-            return True
-
-    build_ext = Distribution({"ext_modules": L()}).get_command_obj("build_ext")
-    build_ext.finalize_options()
-    build_ext.run()
-    return build_ext.compiler
-
-
-class FreeType(SetupPackage):
-    name = "freetype"
-
-    @classmethod
-    def add_flags(cls, ext):
-        # checkdep_freetype2.c immediately aborts the compilation either with
-        # "foo.h: No such file or directory" if the header is not found, or an
-        # appropriate error message if the header indicates a too-old version.
-        ext.sources.insert(0, 'src/checkdep_freetype2.c')
-        if options.get('system_freetype'):
-            pkg_config_setup_extension(
-                # FreeType 2.3 has libtool version 9.11.3 as can be checked
-                # from the tarball.  For FreeType>=2.4, there is a conversion
-                # table in docs/VERSIONS.txt in the FreeType source tree.
-                ext, 'freetype2',
-                atleast_version='9.11.3',
-                alt_exec=['freetype-config'],
-                default_libraries=['freetype'])
-            ext.define_macros.append(('FREETYPE_BUILD_TYPE', 'system'))
-        else:
-            src_path = Path('build', f'freetype-{LOCAL_FREETYPE_VERSION}')
-            # Statically link to the locally-built freetype.
-            ext.include_dirs.insert(0, str(src_path / 'include'))
-            ext.extra_objects.insert(
-                0, str((src_path / 'objs/.libs/libfreetype').with_suffix(
-                    '.lib' if sys.platform == 'win32' else '.a')))
-            ext.define_macros.append(('FREETYPE_BUILD_TYPE', 'local'))
-            if sys.platform == 'darwin':
-                name = ext.name.split('.')[-1]
-                ext.extra_link_args.append(
-                    f'-Wl,-exported_symbol,_PyInit_{name}')
-
-    def do_custom_build(self, env):
-        # We're using a system freetype
-        if options.get('system_freetype'):
-            return
-
-        tarball = f'freetype-{LOCAL_FREETYPE_VERSION}.tar.gz'
-        src_path = get_and_extract_tarball(
-            urls=[
-                (f'https://downloads.sourceforge.net/project/freetype'
-                 f'/freetype2/{LOCAL_FREETYPE_VERSION}/{tarball}'),
-                (f'https://download.savannah.gnu.org/releases/freetype'
-                 f'/{tarball}'),
-                (f'https://download.savannah.gnu.org/releases/freetype'
-                 f'/freetype-old/{tarball}')
-            ],
-            sha=LOCAL_FREETYPE_HASH,
-            dirname=f'freetype-{LOCAL_FREETYPE_VERSION}',
-        )
-
-        libfreetype = (src_path / "objs/.libs/libfreetype").with_suffix(
-            ".lib" if sys.platform == "win32" else ".a")
-        if libfreetype.is_file():
-            return  # Bail out because we have already built FreeType.
-
-        print(f"Building freetype in {src_path}")
-        if sys.platform != 'win32':  # compilation on non-windows
-            env = {
-                **{
-                    var: value
-                    for var, value in sysconfig.get_config_vars().items()
-                    if var in {"CC", "CFLAGS", "CXX", "CXXFLAGS", "LD",
-                               "LDFLAGS"}
-                },
-                **env,
-            }
-            configure_ac = Path(src_path, "builds/unix/configure.ac")
-            if ((src_path / "autogen.sh").exists()
-                    and not configure_ac.exists()):
-                print(f"{configure_ac} does not exist. "
-                      f"Using sh autogen.sh to generate.")
-                subprocess.check_call(
-                    ["sh", "./autogen.sh"], env=env, cwd=src_path)
-            env["CFLAGS"] = env.get("CFLAGS", "") + " -fPIC"
-            configure = [
-                "./configure", "--with-zlib=no", "--with-bzip2=no",
-                "--with-png=no", "--with-harfbuzz=no", "--enable-static",
-                "--disable-shared"
-            ]
-            host = sysconfig.get_config_var('HOST_GNU_TYPE')
-            if host is not None:  # May be unset on PyPy.
-                configure.append(f"--host={host}")
-            subprocess.check_call(configure, env=env, cwd=src_path)
-            if 'GNUMAKE' in env:
-                make = env['GNUMAKE']
-            elif 'MAKE' in env:
-                make = env['MAKE']
-            else:
-                try:
-                    output = subprocess.check_output(['make', '-v'],
-                                                     stderr=subprocess.DEVNULL)
-                except subprocess.CalledProcessError:
-                    output = b''
-                if b'GNU' not in output and b'makepp' not in output:
-                    make = 'gmake'
-                else:
-                    make = 'make'
-            subprocess.check_call([make], env=env, cwd=src_path)
-        else:  # compilation on windows
-            shutil.rmtree(src_path / "objs", ignore_errors=True)
-            base_path = Path(
-                f"build/freetype-{LOCAL_FREETYPE_VERSION}/builds/windows"
-            )
-            vc = 'vc2010'
-            sln_path = base_path / vc / "freetype.sln"
-            # https://developercommunity.visualstudio.com/comments/190992/view.html
-            (sln_path.parent / "Directory.Build.props").write_text(
-                "<?xml version='1.0' encoding='utf-8'?>"
-                "<Project>"
-                "<PropertyGroup>"
-                # WindowsTargetPlatformVersion must be given on a single line.
-                "<WindowsTargetPlatformVersion>$("
-                "[Microsoft.Build.Utilities.ToolLocationHelper]"
-                "::GetLatestSDKTargetPlatformVersion('Windows', '10.0')"
-                ")</WindowsTargetPlatformVersion>"
-                "</PropertyGroup>"
-                "</Project>",
-                encoding="utf-8")
-            # It is not a trivial task to determine PlatformToolset to plug it
-            # into msbuild command, and Directory.Build.props will not override
-            # the value in the project file.
-            # The DefaultPlatformToolset is from Microsoft.Cpp.Default.props
-            with open(base_path / vc / "freetype.vcxproj", 'r+b') as f:
-                toolset_repl = b'PlatformToolset>$(DefaultPlatformToolset)<'
-                vcxproj = f.read().replace(b'PlatformToolset>v100<',
-                                           toolset_repl)
-                assert toolset_repl in vcxproj, (
-                   'Upgrading Freetype might break this')
-                f.seek(0)
-                f.truncate()
-                f.write(vcxproj)
-
-            cc = get_ccompiler()
-            cc.initialize()
-            # On setuptools versions that use "local" distutils,
-            # ``cc.spawn(["msbuild", ...])`` no longer manages to locate the
-            # right executable, even though they are correctly on the PATH,
-            # because only the env kwarg to Popen() is updated, and not
-            # os.environ["PATH"]. Instead, use shutil.which to walk the PATH
-            # and get absolute executable paths.
-            with TemporaryDirectory() as tmpdir:
-                dest = Path(tmpdir, "path")
-                cc.spawn([
-                    sys.executable, "-c",
-                    "import pathlib, shutil, sys
"
-                    "dest = pathlib.Path(sys.argv[1])
"
-                    "dest.write_text(shutil.which('msbuild'))
",
-                    str(dest),
-                ])
-                msbuild_path = dest.read_text()
-            msbuild_platform = (
-                "ARM64" if platform.machine() == "ARM64" else
-                "x64" if platform.architecture()[0] == "64bit" else
-                "Win32")
-            # Freetype 2.10.0+ support static builds.
-            msbuild_config = (
-                "Release Static"
-                if [*map(int, LOCAL_FREETYPE_VERSION.split("."))] >= [2, 10]
-                else "Release"
-            )
-
-            cc.spawn([msbuild_path, str(sln_path),
-                      "/t:Clean;Build",
-                      f"/p:Configuration={msbuild_config};"
-                      f"Platform={msbuild_platform}"])
-            # Move to the corresponding Unix build path.
-            libfreetype.parent.mkdir()
-            # Be robust against change of FreeType version.
-            lib_paths = Path(src_path / "objs").rglob('freetype*.lib')
-            # Select FreeType library for required platform
-            lib_path, = [
-                p for p in lib_paths
-                if msbuild_platform in p.resolve().as_uri()
-            ]
-            print(f"Copying {lib_path} to {libfreetype}")
-            shutil.copy2(lib_path, libfreetype)
-
-
-class Qhull(SetupPackage):
-    name = "qhull"
-    _extensions_to_update = []
-
-    @classmethod
-    def add_flags(cls, ext):
-        if options.get("system_qhull"):
-            ext.libraries.append("qhull_r")
-        else:
-            cls._extensions_to_update.append(ext)
-
-    def do_custom_build(self, env):
-        if options.get('system_qhull'):
-            return
-
-        toplevel = get_and_extract_tarball(
-            urls=["http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz"],
-            sha=LOCAL_QHULL_HASH,
-            dirname=f"qhull-{LOCAL_QHULL_VERSION}",
-        )
-        shutil.copyfile(toplevel / "COPYING.txt", "LICENSE/LICENSE_QHULL")
-
-        for ext in self._extensions_to_update:
-            qhull_path = Path(f'build/qhull-{LOCAL_QHULL_VERSION}/src')
-            ext.include_dirs.insert(0, str(qhull_path))
-            ext.sources.extend(
-                map(str, sorted(qhull_path.glob('libqhull_r/*.c'))))
-            if sysconfig.get_config_var("LIBM") == "-lm":
-                ext.libraries.extend("m")
-
-
-class BackendMacOSX(OptionalPackage):
-    name = 'macosx'
-
-    def check(self):
-        if sys.platform != 'darwin':
-            raise Skipped("Mac OS-X only")
-        return super().check()
-
-    def get_extensions(self):
-        ext = Extension(
-            'matplotlib.backends._macosx', [
-                'src/_macosx.m'
-            ])
-        ext.extra_compile_args.extend(['-Werror'])
-        ext.extra_link_args.extend(['-framework', 'Cocoa'])
-        if platform.python_implementation().lower() == 'pypy':
-            ext.extra_compile_args.append('-DPYPY=1')
-        yield ext
+ source /opt/miniconda3/bin/activate
++ _CONDA_ROOT=/opt/miniconda3
++ . /opt/miniconda3/etc/profile.d/conda.sh
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ '[' -z x ']'
++ conda activate
++ local cmd=activate
++ case "$cmd" in
++ __conda_activate activate
++ '[' -n '' ']'
++ local ask_conda
+++ PS1='(testbed) '
+++ __conda_exe shell.posix activate
+++ /opt/miniconda3/bin/conda shell.posix activate
++ ask_conda='. "/opt/miniconda3/envs/testbed/etc/conda/deactivate.d/libxml2_deactivate.sh"
. "/opt/miniconda3/envs/testbed/etc/conda/deactivate.d/libglib_deactivate.sh"
PS1='''(base) '''
export PATH='''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3'''
export CONDA_SHLVL='''3'''
export CONDA_DEFAULT_ENV='''base'''
export CONDA_PROMPT_MODIFIER='''(base) '''
export CONDA_PREFIX_2='''/opt/miniconda3/envs/testbed'''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python''''
++ eval '. "/opt/miniconda3/envs/testbed/etc/conda/deactivate.d/libxml2_deactivate.sh"
. "/opt/miniconda3/envs/testbed/etc/conda/deactivate.d/libglib_deactivate.sh"
PS1='''(base) '''
export PATH='''/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3'''
export CONDA_SHLVL='''3'''
export CONDA_DEFAULT_ENV='''base'''
export CONDA_PROMPT_MODIFIER='''(base) '''
export CONDA_PREFIX_2='''/opt/miniconda3/envs/testbed'''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python''''
+++ . /opt/miniconda3/envs/testbed/etc/conda/deactivate.d/libxml2_deactivate.sh
++++ test -n ''
++++ unset XML_CATALOG_FILES
++++ unset xml_catalog_files_libxml2
+++ . /opt/miniconda3/envs/testbed/etc/conda/deactivate.d/libglib_deactivate.sh
++++ export GSETTINGS_SCHEMA_DIR=
++++ GSETTINGS_SCHEMA_DIR=
++++ unset GSETTINGS_SCHEMA_DIR_CONDA_BACKUP
++++ '[' -z ']'
++++ unset GSETTINGS_SCHEMA_DIR
+++ PS1='(base) '
+++ export PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ PATH=/opt/miniconda3/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+++ export CONDA_PREFIX=/opt/miniconda3
+++ CONDA_PREFIX=/opt/miniconda3
+++ export CONDA_SHLVL=3
+++ CONDA_SHLVL=3
+++ export CONDA_DEFAULT_ENV=base
+++ CONDA_DEFAULT_ENV=base
+++ export 'CONDA_PROMPT_MODIFIER=(base) '
+++ CONDA_PROMPT_MODIFIER='(base) '
+++ export CONDA_PREFIX_2=/opt/miniconda3/envs/testbed
+++ CONDA_PREFIX_2=/opt/miniconda3/envs/testbed
+++ export CONDA_EXE=/opt/miniconda3/bin/conda
+++ CONDA_EXE=/opt/miniconda3/bin/conda
+++ export _CE_M=
+++ _CE_M=
+++ export _CE_CONDA=
+++ _CE_CONDA=
+++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
+++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ __conda_hashr
++ '[' -n '' ']'
++ '[' -n '' ']'
++ hash -r
+ conda activate testbed
+ local cmd=activate
+ case "$cmd" in
+ __conda_activate activate testbed
+ '[' -n '' ']'
+ local ask_conda
++ PS1='(base) '
++ __conda_exe shell.posix activate testbed
++ /opt/miniconda3/bin/conda shell.posix activate testbed
+ ask_conda='PS1='''(testbed) '''
export PATH='''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3/envs/testbed'''
export CONDA_SHLVL='''4'''
export CONDA_DEFAULT_ENV='''testbed'''
export CONDA_PROMPT_MODIFIER='''(testbed) '''
export CONDA_PREFIX_3='''/opt/miniconda3'''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python'''
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libglib_activate.sh"
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libxml2_activate.sh"'
+ eval 'PS1='''(testbed) '''
export PATH='''/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'''
export CONDA_PREFIX='''/opt/miniconda3/envs/testbed'''
export CONDA_SHLVL='''4'''
export CONDA_DEFAULT_ENV='''testbed'''
export CONDA_PROMPT_MODIFIER='''(testbed) '''
export CONDA_PREFIX_3='''/opt/miniconda3'''
export CONDA_EXE='''/opt/miniconda3/bin/conda'''
export _CE_M=''''''
export _CE_CONDA=''''''
export CONDA_PYTHON_EXE='''/opt/miniconda3/bin/python'''
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libglib_activate.sh"
. "/opt/miniconda3/envs/testbed/etc/conda/activate.d/libxml2_activate.sh"'
++ PS1='(testbed) '
++ export PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ PATH=/opt/miniconda3/envs/testbed/bin:/opt/miniconda3/condabin:/opt/miniconda3/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
++ export CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ CONDA_PREFIX=/opt/miniconda3/envs/testbed
++ export CONDA_SHLVL=4
++ CONDA_SHLVL=4
++ export CONDA_DEFAULT_ENV=testbed
++ CONDA_DEFAULT_ENV=testbed
++ export 'CONDA_PROMPT_MODIFIER=(testbed) '
++ CONDA_PROMPT_MODIFIER='(testbed) '
++ export CONDA_PREFIX_3=/opt/miniconda3
++ CONDA_PREFIX_3=/opt/miniconda3
++ export CONDA_EXE=/opt/miniconda3/bin/conda
++ CONDA_EXE=/opt/miniconda3/bin/conda
++ export _CE_M=
++ _CE_M=
++ export _CE_CONDA=
++ _CE_CONDA=
++ export CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ CONDA_PYTHON_EXE=/opt/miniconda3/bin/python
++ . /opt/miniconda3/envs/testbed/etc/conda/activate.d/libglib_activate.sh
+++ export GSETTINGS_SCHEMA_DIR_CONDA_BACKUP=
+++ GSETTINGS_SCHEMA_DIR_CONDA_BACKUP=
+++ export GSETTINGS_SCHEMA_DIR=/opt/miniconda3/envs/testbed/share/glib-2.0/schemas
+++ GSETTINGS_SCHEMA_DIR=/opt/miniconda3/envs/testbed/share/glib-2.0/schemas
++ . /opt/miniconda3/envs/testbed/etc/conda/activate.d/libxml2_activate.sh
+++ test -n ''
+++ xml_catalog_files_libxml2=
+++ XML_CATALOG_FILES=
+++ conda_catalog_files=
+++ ifs_libxml2=' 	
'
+++ IFS=' '
+++ rem=/opt/miniconda3/envs/testbed
+++ for pre in ${rem}
+++ test '' = /opt/miniconda3/envs/testbed
+++ conda_catalog_files=/opt/miniconda3/envs/testbed
+++ rem=
+++ IFS=' 	
'
+++ conda_catalog_files='file:///opt/miniconda3/envs/testbed/etc/xml/catalog file:///etc/xml/catalog'
+++ export 'XML_CATALOG_FILES=file:///opt/miniconda3/envs/testbed/etc/xml/catalog file:///etc/xml/catalog'
+++ XML_CATALOG_FILES='file:///opt/miniconda3/envs/testbed/etc/xml/catalog file:///etc/xml/catalog'
+++ unset conda_catalog_files ifs_libxml2 rem
+ __conda_hashr
+ '[' -n '' ']'
+ '[' -n '' ']'
+ hash -r
+ python -m pip install -e .
Obtaining file:///testbed
  Installing build dependencies: started
  Installing build dependencies: finished with status 'done'
  Checking if build backend supports build_editable: started
  Checking if build backend supports build_editable: finished with status 'done'
  Getting requirements to build editable: started
  Getting requirements to build editable: finished with status 'done'
  Preparing editable metadata (pyproject.toml): started
  Preparing editable metadata (pyproject.toml): finished with status 'done'
Building wheels for collected packages: UNKNOWN
  Building editable for UNKNOWN (pyproject.toml): started
  Building editable for UNKNOWN (pyproject.toml): finished with status 'done'
  Created wheel for UNKNOWN: filename=unknown-0.0.0-0.editable-py3-none-any.whl size=19891 sha256=2abf5553d753410d8a166a3dd00bd1705b19dd8d54a4a02c1fd5c8af407285e9
  Stored in directory: /tmp/pip-ephem-wheel-cache-pjidkfet/wheels/49/5f/4f/01b7d31ea6ddac9643da788242d33e5fd3467d95d17b032c6b
Successfully built UNKNOWN
Installing collected packages: UNKNOWN
Successfully installed UNKNOWN-0.0.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
+ git checkout 1d0d255b79e84dfc9f2123c5eb85a842d342f72b lib/matplotlib/tests/test_figure.py
Updated 0 paths from 1d1584dcc6
+ git apply -v -
Checking patch lib/matplotlib/tests/test_figure.py...
Applied patch lib/matplotlib/tests/test_figure.py cleanly.
+ : '>>>>> Start Test Output'
+ pytest -rA lib/matplotlib/tests/test_figure.py
============================= test session starts ==============================
platform linux -- Python 3.11.10, pytest-8.3.3, pluggy-1.5.0
rootdir: /testbed
configfile: pytest.ini
plugins: timeout-2.3.1, cov-5.0.0, xdist-3.6.1, rerunfailures-14.0
collected 145 items

lib/matplotlib/tests/test_figure.py .s......s..s.....s....s............. [ 24%]
..............................ss........................................ [ 74%]
....FF.FFF.F.F.......................                                    [100%]

=================================== FAILURES ===================================
_____________________________ test_subfigure[png] ______________________________

args = ()
kwds = {'extension': 'png', 'request': <FixtureRequest for <Function test_subfigure[png]>>}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           matplotlib.testing.exceptions.ImageComparisonFailure: images not close (RMS 14.964):
E           	result_images/test_figure/test_subfigure.png
E           	result_images/test_figure/test_subfigure-expected.png
E           	result_images/test_figure/test_subfigure-failed-diff.png

/opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: ImageComparisonFailure
___________________________ test_subfigure_tightbbox ___________________________

    def test_subfigure_tightbbox():
        # test that we can get the tightbbox with a subfigure...
        fig = plt.figure(layout='constrained')
        sub = fig.subfigures(1, 2)
    
>       np.testing.assert_allclose(
                fig.get_tightbbox(fig.canvas.get_renderer()).width,
                8.0)

lib/matplotlib/tests/test_figure.py:1288: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7f02c80d0180>, array(6.2), array(8.))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-07, atol=0', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-07, atol=0
E           
E           Mismatched elements: 1 / 1 (100%)
E           Max absolute difference: 1.8
E           Max relative difference: 0.225
E            x: array(6.2)
E            y: array(8.)

/opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: AssertionError
____________________________ test_subfigure_ss[png] ____________________________

args = ()
kwds = {'extension': 'png', 'request': <FixtureRequest for <Function test_subfigure_ss[png]>>}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           matplotlib.testing.exceptions.ImageComparisonFailure: images not close (RMS 9.922):
E           	result_images/test_figure/test_subfigure_ss.png
E           	result_images/test_figure/test_subfigure_ss-expected.png
E           	result_images/test_figure/test_subfigure_ss-failed-diff.png

/opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: ImageComparisonFailure
__________________________ test_subfigure_double[png] __________________________

args = ()
kwds = {'extension': 'png', 'request': <FixtureRequest for <Function test_subfigure_double[png]>>}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           matplotlib.testing.exceptions.ImageComparisonFailure: images not close (RMS 7.229):
E           	result_images/test_figure/test_subfigure_double.png
E           	result_images/test_figure/test_subfigure_double-expected.png
E           	result_images/test_figure/test_subfigure_double-failed-diff.png

/opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: ImageComparisonFailure
___________________________ test_subfigure_spanning ____________________________

    def test_subfigure_spanning():
        # test that subfigures get laid out properly...
        fig = plt.figure(constrained_layout=True)
        gs = fig.add_gridspec(3, 3)
        sub_figs = [
            fig.add_subfigure(gs[0, 0]),
            fig.add_subfigure(gs[0:2, 1]),
            fig.add_subfigure(gs[2, 1:3]),
            fig.add_subfigure(gs[0:, 1:])
        ]
    
        w = 640
        h = 480
>       np.testing.assert_allclose(sub_figs[0].bbox.min, [0., h * 2/3])

lib/matplotlib/tests/test_figure.py:1381: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7f02c9d39d00>, array([ 80.        , 319.05882353]), array([  0., 320.]))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-07, atol=0', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-07, atol=0
E           
E           Mismatched elements: 2 / 2 (100%)
E           Max absolute difference: 80.
E           Max relative difference: 0.00294118
E            x: array([ 80.      , 319.058824])
E            y: array([  0., 320.])

/opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: AssertionError
_______________________ test_subfigure_scatter_size[png] _______________________

args = ()
kwds = {'extension': 'png', 'request': <FixtureRequest for <Function test_subfigure_scatter_size[png]>>}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           matplotlib.testing.exceptions.ImageComparisonFailure: images not close (RMS 29.848):
E           	result_images/test_figure/test_subfigure_scatter_size.png
E           	result_images/test_figure/test_subfigure_scatter_size-expected.png
E           	result_images/test_figure/test_subfigure_scatter_size-failed-diff.png

/opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: ImageComparisonFailure
________________________ test_subfigures_wspace_hspace _________________________

    def test_subfigures_wspace_hspace():
        sub_figs = plt.figure().subfigures(2, 3, hspace=0.5, wspace=1/6.)
    
        w = 640
        h = 480
    
>       np.testing.assert_allclose(sub_figs[0, 0].bbox.min, [0., h * 0.6])

lib/matplotlib/tests/test_figure.py:1458: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7f02c82c2a20>, array([ 80. , 278.4]), array([  0., 288.]))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-07, atol=0', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-07, atol=0
E           
E           Mismatched elements: 2 / 2 (100%)
E           Max absolute difference: 80.
E           Max relative difference: 0.03333333
E            x: array([ 80. , 278.4])
E            y: array([  0., 288.])

/opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: AssertionError
==================================== PASSES ====================================
=========================== short test summary info ============================
PASSED lib/matplotlib/tests/test_figure.py::test_align_labels[png]
PASSED lib/matplotlib/tests/test_figure.py::test_align_labels_stray_axes
PASSED lib/matplotlib/tests/test_figure.py::test_figure_label
PASSED lib/matplotlib/tests/test_figure.py::test_fignum_exists
PASSED lib/matplotlib/tests/test_figure.py::test_clf_keyword
PASSED lib/matplotlib/tests/test_figure.py::test_figure[png]
PASSED lib/matplotlib/tests/test_figure.py::test_figure[pdf]
PASSED lib/matplotlib/tests/test_figure.py::test_figure_legend[png]
PASSED lib/matplotlib/tests/test_figure.py::test_figure_legend[pdf]
PASSED lib/matplotlib/tests/test_figure.py::test_gca
PASSED lib/matplotlib/tests/test_figure.py::test_add_subplot_subclass
PASSED lib/matplotlib/tests/test_figure.py::test_add_subplot_invalid
PASSED lib/matplotlib/tests/test_figure.py::test_suptitle[png]
PASSED lib/matplotlib/tests/test_figure.py::test_suptitle[pdf]
PASSED lib/matplotlib/tests/test_figure.py::test_suptitle_fontproperties
PASSED lib/matplotlib/tests/test_figure.py::test_suptitle_subfigures
PASSED lib/matplotlib/tests/test_figure.py::test_get_suptitle_supxlabel_supylabel
PASSED lib/matplotlib/tests/test_figure.py::test_alpha[png]
PASSED lib/matplotlib/tests/test_figure.py::test_too_many_figures
PASSED lib/matplotlib/tests/test_figure.py::test_iterability_axes_argument
PASSED lib/matplotlib/tests/test_figure.py::test_set_fig_size
PASSED lib/matplotlib/tests/test_figure.py::test_axes_remove
PASSED lib/matplotlib/tests/test_figure.py::test_figaspect
PASSED lib/matplotlib/tests/test_figure.py::test_autofmt_xdate[both]
PASSED lib/matplotlib/tests/test_figure.py::test_autofmt_xdate[major]
PASSED lib/matplotlib/tests/test_figure.py::test_autofmt_xdate[minor]
PASSED lib/matplotlib/tests/test_figure.py::test_change_dpi
PASSED lib/matplotlib/tests/test_figure.py::test_invalid_figure_size[1-nan]
PASSED lib/matplotlib/tests/test_figure.py::test_invalid_figure_size[-1-1]
PASSED lib/matplotlib/tests/test_figure.py::test_invalid_figure_size[inf-1]
PASSED lib/matplotlib/tests/test_figure.py::test_invalid_figure_add_axes
PASSED lib/matplotlib/tests/test_figure.py::test_subplots_shareax_loglabels
PASSED lib/matplotlib/tests/test_figure.py::test_savefig
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_warns
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_backend
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_pixel_ratio[Agg]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_pixel_ratio[Cairo]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_preserve_layout_engine
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_locate_colorbar
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_transparent[png]
PASSED lib/matplotlib/tests/test_figure.py::test_figure_repr
PASSED lib/matplotlib/tests/test_figure.py::test_valid_layouts
PASSED lib/matplotlib/tests/test_figure.py::test_invalid_layouts
PASSED lib/matplotlib/tests/test_figure.py::test_tightlayout_autolayout_deconflict[png]
PASSED lib/matplotlib/tests/test_figure.py::test_layout_change_warning[constrained]
PASSED lib/matplotlib/tests/test_figure.py::test_layout_change_warning[compressed]
PASSED lib/matplotlib/tests/test_figure.py::test_add_artist[png]
PASSED lib/matplotlib/tests/test_figure.py::test_add_artist[pdf]
PASSED lib/matplotlib/tests/test_figure.py::test_fspath[png]
PASSED lib/matplotlib/tests/test_figure.py::test_fspath[pdf]
PASSED lib/matplotlib/tests/test_figure.py::test_fspath[ps]
PASSED lib/matplotlib/tests/test_figure.py::test_fspath[eps]
PASSED lib/matplotlib/tests/test_figure.py::test_fspath[svg]
PASSED lib/matplotlib/tests/test_figure.py::test_tightbbox
PASSED lib/matplotlib/tests/test_figure.py::test_axes_removal
PASSED lib/matplotlib/tests/test_figure.py::test_removed_axis
PASSED lib/matplotlib/tests/test_figure.py::test_figure_clear[clear]
PASSED lib/matplotlib/tests/test_figure.py::test_figure_clear[clf]
PASSED lib/matplotlib/tests/test_figure.py::test_clf_not_redefined
PASSED lib/matplotlib/tests/test_figure.py::test_picking_does_not_stale
PASSED lib/matplotlib/tests/test_figure.py::test_add_subplot_twotuple
PASSED lib/matplotlib/tests/test_figure.py::test_animated_with_canvas_change[pdf]
PASSED lib/matplotlib/tests/test_figure.py::test_animated_with_canvas_change[eps]
PASSED lib/matplotlib/tests/test_figure.py::test_animated_with_canvas_change[png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_basic[x0-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_basic[x1-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_basic[x2-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_basic[x3-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_all_nested[png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_nested[png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_nested_tuple[png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_nested_width_ratios
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_nested_height_ratios
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x0-None-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x1-SKIP-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x2-0-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x3-None-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x4-SKIP-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x5-0-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_fail_list_of_str
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_subplot_kw[subplot_kw0-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_subplot_kw[subplot_kw1-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_subplot_kw[None-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_per_subplot_kw[BC-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_per_subplot_kw[multi_value1-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_string_parser
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_per_subplot_kw_expander
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_extra_per_subplot_kw
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_single_str_input[AAA
BBB-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_single_str_input[
AAA
BBB
-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_single_str_input[ABC
DEF-png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_fail[x0-(?m)we found that the label .A. specifies a non-rectangular or non-contiguous area.]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_fail[x1-There are duplicate keys .* between the outer layout]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_fail[AAA
c
BBB-All of the rows must be the same length]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_fail[x3-All of the rows must be the same length]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_hashable_keys[png]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_user_order[abc]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_user_order[cab]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_user_order[bca]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_user_order[cba]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_user_order[acb]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_user_order[bac]
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_nested_user_order
PASSED lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_share_all
PASSED lib/matplotlib/tests/test_figure.py::test_reused_gridspec
PASSED lib/matplotlib/tests/test_figure.py::test_subfigure_dpi
PASSED lib/matplotlib/tests/test_figure.py::test_subfigure_ticks
PASSED lib/matplotlib/tests/test_figure.py::test_subfigure_pdf
PASSED lib/matplotlib/tests/test_figure.py::test_add_subplot_kwargs
PASSED lib/matplotlib/tests/test_figure.py::test_add_axes_kwargs
PASSED lib/matplotlib/tests/test_figure.py::test_ginput
PASSED lib/matplotlib/tests/test_figure.py::test_waitforbuttonpress
PASSED lib/matplotlib/tests/test_figure.py::test_kwargs_pass
PASSED lib/matplotlib/tests/test_figure.py::test_rcparams[png]
PASSED lib/matplotlib/tests/test_figure.py::test_deepcopy
PASSED lib/matplotlib/tests/test_figure.py::test_unpickle_with_device_pixel_ratio
PASSED lib/matplotlib/tests/test_figure.py::test_gridspec_no_mutate_input
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata[eps]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata[pdf]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata[png]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata[ps]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata[svg]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata[svgz]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata_error[jpeg]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata_error[jpg]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata_error[tif]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata_error[tiff]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata_error[webp]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata_error[raw]
PASSED lib/matplotlib/tests/test_figure.py::test_savefig_metadata_error[rgba]
PASSED lib/matplotlib/tests/test_figure.py::test_get_constrained_layout_pads
SKIPPED [6] ../opt/miniconda3/envs/testbed/lib/python3.11/contextlib.py:81: Cannot compare svg files because Inkscape is not installed
SKIPPED [1] lib/matplotlib/testing/compare.py:285: Don't know how to convert .svg files to png
FAILED lib/matplotlib/tests/test_figure.py::test_subfigure[png] - matplotlib....
FAILED lib/matplotlib/tests/test_figure.py::test_subfigure_tightbbox - Assert...
FAILED lib/matplotlib/tests/test_figure.py::test_subfigure_ss[png] - matplotl...
FAILED lib/matplotlib/tests/test_figure.py::test_subfigure_double[png] - matp...
FAILED lib/matplotlib/tests/test_figure.py::test_subfigure_spanning - Asserti...
FAILED lib/matplotlib/tests/test_figure.py::test_subfigure_scatter_size[png]
FAILED lib/matplotlib/tests/test_figure.py::test_subfigures_wspace_hspace - A...
================== 7 failed, 131 passed, 7 skipped in 13.40s ===================
+ : '>>>>> End Test Output'
+ git checkout 1d0d255b79e84dfc9f2123c5eb85a842d342f72b lib/matplotlib/tests/test_figure.py
Updated 1 path from 1d1584dcc6
