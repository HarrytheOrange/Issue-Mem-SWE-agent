{
    "search_index": {
        "description_for_embedding": "Fix a long-standing typo in the StackStorm action runner cancel RabbitMQ queue name from `st2.actionrunner.canel` to `st2.actionrunner.cancel`, ensure producers/consumers are updated, and document the change in the changelog for users who monitor queues.",
        "keywords": [
            "StackStorm",
            "action runner",
            "RabbitMQ",
            "message queue",
            "queue name typo",
            "st2.actionrunner.canel",
            "st2.actionrunner.cancel",
            "backwards compatibility",
            "distributed systems",
            "upgrade notes"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this incident, a typo in a core RabbitMQ queue name had existed for some time in the StackStorm codebase. The action runner cancel queue was named `st2.actionrunner.canel` instead of `st2.actionrunner.cancel`. Initially, someone proposed a simple string replacement, assuming it was just a cosmetic typo. However, maintainers quickly pointed out that the misspelt value was actually the live, deployed queue name in RabbitMQ clusters. Changing it naively would introduce a new queue (`st2.actionrunner.cancel`) while leaving the old `st2.actionrunner.canel` queue hanging around, and could impact operators who monitor queue names.\n\nAfter discussion, they determined that the change would not break message flow because all producers/consumers obtain the queue name via helper functions (`liveaction.get_status_management_queue`) and the `get_worker` helper, so changing the constant in one place would naturally re-point all components to the new queue. The old queue would simply remain unused. A maintainer verified behavior by:\n\n1. Listing queues via `rabbitmqctl list_queues | grep st2` and confirming that both `st2.actionrunner.canel` and `st2.actionrunner.cancel` could exist.\n2. Running and canceling an action (`st2 run core.local ...` followed by `st2 execution cancel ...`) to confirm that cancel flows still worked as expected after the change.\n\nThe final PR included:\n- Renaming the queue name in `st2actions/st2actions/worker.py` from `st2.actionrunner.canel` to `st2.actionrunner.cancel`.\n- Renaming the same queue in the shared transport definitions in `st2common/st2common/transport/queues.py`.\n- Updating the changelog (`CHANGELOG.rst`) to explicitly document the rename and reference the PR number, so users who monitor those queues (for example via external monitoring or alerting) are aware of the change.\n- A minor PEP8 style fix (adding a blank line before `ActionExecutionDispatcher`).\n\nThere was initial concern that a migration would be required to avoid breaking existing deployments, but after inspection and live testing, the team concluded that no special migration logic was necessary; the system would automatically use the new queue name, and the old queue would merely remain as an unused artifact. The main operational requirement was to clearly call out the change in upgrade notes.",
        "semantic_memory": "This case illustrates several generalizable lessons about fixing naming issues in distributed systems and message-based architectures:\n\n1. **Names in code vs names in infrastructure**: A string constant in code may also represent a live resource in infrastructure (e.g., a message queue, topic, or table). Renaming it is not purely cosmetic; it changes the runtime behavior and may affect other services or user tooling.\n\n2. **Backward compatibility for queues and topics**: When renaming queues or topics in a running system, consider:\n   - Whether all producers and consumers derive the name from a central helper or configuration, so a single change updates the whole system.\n   - Whether any external tools (monitoring/alerting, scripts, dashboards) or user documentation depend on the old name.\n   - Whether both old and new queues can temporarily coexist without breaking message flow.\n\n3. **Operational visibility and monitoring**: Operators often monitor queue names directly. Even if systems remain functional after a rename, monitoring and alerting may silently break. Changes to queue names should be explicitly documented in upgrade notes or changelogs.\n\n4. **Minimal migration strategy**: Sometimes the safest and simplest migration is to:\n   - Start writing/reading from the new queue name by updating the code.\n   - Leave the old queue in place (harmless but unused) rather than forcibly deleting or remapping it, avoiding risk of message loss.\n\n5. **Verification is critical even for 'trivial' fixes**: A seemingly trivial typo fix can have non-trivial runtime effects. Always verify by running real flows (e.g., executing and canceling actions) and inspecting the backing infrastructure (e.g., `rabbitmqctl list_queues`) to ensure behavior remains correct.\n\n6. **Centralized queue definitions**: Defining queues in a shared module (like `queues.py`) and using helper functions (`get_status_management_queue`) reduces the risk of inconsistent names and makes global renames more reliable.\n\n7. **Document behavioral changes, not just bugs**: Even when there is no user-facing error message, changes that affect infrastructure naming, routing keys, or resource identifiers should be clearly documented, tagged as improvements, and associated with specific PRs so users can understand and trace them.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Confirm the suspected typo is actually used at runtime",
            "• Search the codebase for the string (e.g., `grep -R \"canel\" .` or IDE search).\n• Identify whether the string is used as an identifier for an external resource (queue, topic, table, index, etc.) rather than just user-facing text.\n• In the relevant infrastructure (e.g., RabbitMQ), list resources to see if the exact misspelled name exists and is active:\n  - `rabbitmqctl list_queues | grep <suspected-name>`.",
            "Step 2: Understand how the name is consumed across the system",
            "• Find all call sites or helpers that use the name (e.g., `get_status_management_queue`, `get_worker`, or other factory functions).\n• Determine if producers and consumers both derive the name from a shared constant / helper, or if some hard-code the literal name elsewhere.\n• Check for external dependencies such as:\n  - Monitoring alerts keyed on the queue name.\n  - Scripts or integrations that reference the name directly.\n  - Documentation or dashboards displaying that name.",
            "Step 3: Assess backward compatibility and migration needs",
            "• Ask:\n  - If we change this string, will any service stop receiving messages or writing to the correct destination?\n  - Can both old and new identifiers coexist temporarily (e.g., two queues), or is it a single global resource (e.g., a DB table)?\n• Decide on a strategy:\n  - **Simple rename**: If everything uses a central helper and no external hard-coding is found, change the constant and rely on the system to adopt the new name.\n  - **Dual support**: If some components still need the old name for a time, configure consumers to listen on both queues or create an alias/binding.\n  - **Explicit migration**: If the resource contains important state (e.g., DB table), plan data migration or transitional code.",
            "Step 4: Implement the fix in a centralized, consistent way",
            "• Update the name in the shared module(s) where queues/topics are defined (e.g., `st2common/transport/queues.py`).\n• Update any duplicated references (e.g., in `worker.py` or other services) to use the new name, ideally through the shared helper rather than hard-coded literals.\n• Clean up any obvious stylistic issues while there, but keep the behavioral change minimal and well-scoped.",
            "Step 5: Verify behavior end-to-end in a test or staging environment",
            "• Deploy the change to a test environment.\n• List resources again to confirm new and (optionally) old resources exist as expected, for example:\n  - `rabbitmqctl list_queues | grep st2.actionrunner`.\n• Exercise the relevant functionality thoroughly:\n  - Run a normal flow (e.g., start an action execution).\n  - Trigger the behavior relating to the renamed resource (e.g., cancel that execution).\n  - Confirm status transitions and logs look correct.\n• Monitor for errors in all services that interact with the renamed resource.",
            "Step 6: Plan for the old identifier",
            "• If leaving the old resource is safe and costless (e.g., empty queue), you can leave it for a deprecation period.\n• If it could cause confusion or resource leakage, schedule cleanup:\n  - Decommission or delete old queues/topics once you are confident no component or external tool uses them.\n  - Update scripts/monitoring first so they don’t reference the old name.",
            "Step 7: Document the change clearly",
            "• Add an entry to changelog/upgrade notes describing:\n  - The old and new names (e.g., `st2.actionrunner.canel` → `st2.actionrunner.cancel`).\n  - The potential impact on monitoring or dashboards.\n  - Any recommended user actions (e.g., update alert rules).\n• Reference the PR/issue number so users can read details if needed.",
            "Step 8: Monitor after deployment",
            "• After the change is deployed to production:\n  - Watch system logs for errors about missing queues/topics.\n  - Check that monitoring continues to function as expected (or update it if needed).\n  - Verify that the new resource is actively used and the old one is idle, indicating successful migration."
        ]
    }
}