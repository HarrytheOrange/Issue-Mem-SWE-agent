{
    "search_index": {
        "description_for_embedding": "Home Assistant Zestimate integration bug where sensors did not expose a stable unique_id, causing entities to not consistently map to the same Zillow property (ZPID). Fix adds a unique_id property that returns the ZPID so entities are stably registered and mapped.",
        "keywords": [
            "home-assistant",
            "zestimate",
            "zillow",
            "ZPID",
            "entity registry",
            "unique_id",
            "sensor platform",
            "unstable entity mapping",
            "integration bug",
            "homeassistant.components.zestimate.sensor"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In the Home Assistant Zestimate integration, sensors representing Zillow properties were not exposing a unique_id. As a result, the Home Assistant entity registry could not reliably associate an entity with a specific Zillow property (identified by its ZPID). This could lead to inconsistent or unstable mappings across restarts or configuration changes, where the same physical/logical property might get different entity_ids or fail to map back to the same registry entry. The fix was to implement a unique_id property on the Zestimate sensor class. The property returns self.params['zpid'], using the ZPID (Zillow property ID) as the stable, external identifier. This change ensures that each Zestimate entity is consistently tied to the same ZPID and therefore is correctly tracked by the entity registry over time.",
        "semantic_memory": "When integrating external services or devices into Home Assistant (and similar platforms), each logical entity should expose a stable, deterministic unique identifier. This identifier should be derived from a value that is guaranteed to be unique and persistent on the provider side (e.g., a device serial number, a cloud resource ID, or, as with Zillow, a ZPID). Without unique_id, platforms relying on an entity registry cannot reliably match configuration entries to actual entities across restarts, updates, or reconnects. This can manifest as duplicated entities, changing entity_ids, or loss of customization/history. The best practice is to define a unique_id property or equivalent mechanism that returns this stable external identifier, ensuring consistent entity mapping and a better user experience.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Observe symptoms: Users report entities changing names/ids, duplicating, or losing history/customization after restarts or reconfiguration, especially in integrations backed by a third-party service or device cloud.",
            "Step 2: Check the platform’s entity model: In Home Assistant, inspect the integration’s entity classes (e.g., SensorEntity subclasses) to see if they define a unique_id property. If unique_id is missing or based on non-stable data (like an index or display name), that is a likely cause.",
            "Step 3: Identify a stable external identifier: For the external service/device, determine a field that is globally unique and persistent (e.g., device serial number, MAC address, user ID, cloud object ID, or in this case, Zillow’s ZPID). Verify that it does not change across sessions and uniquely identifies each entity.",
            "Step 4: Implement unique_id: In the entity class, add a unique_id property that returns the chosen stable identifier. For Home Assistant, this typically looks like:\n\n@property\n    def unique_id(self):\n        return self._device_id_or_external_id\n",
            "Step 5: Ensure data is available: Confirm that the identifier is available when the entity is created (e.g., passed in params, stored in the object’s attributes, or retrieved during initial update). Refactor initialization if necessary so the ID is always present.",
            "Step 6: Run tests and local validation: Restart Home Assistant (or the host platform), reload the integration, and verify that entity_ids remain stable across restarts and that no duplicate entries appear in the entity registry. Add or update tests to assert that unique_id is set correctly.",
            "Step 7: Communicate behavior: If this change may alter existing entity_ids (e.g., first-time adoption of unique_id can remap entities), document the behavior so users know what to expect and how to clean up any old entities.",
            "Step 8: Apply pattern to other integrations: Review other related integrations or platforms in the codebase for similar missing unique_id implementations and apply the same pattern of using a stable external ID."
        ]
    }
}