{
    "search_index": {
        "description_for_embedding": "Home Assistant WeMo Humidifier fan platform added a custom service to set target humidity, but it was not declared in services.yaml. This caused the service to be undocumented/invisible in the UI and auto-generated docs. The fix was to align the Python service name `wemo_set_humidity` with a new entry in `homeassistant/components/fan/services.yaml`, describing its fields (`entity_id`, `humidity`) and behavior.",
        "keywords": [
            "Home Assistant",
            "WeMo Humidifier",
            "fan.wemo",
            "wemo_set_humidity",
            "custom service",
            "services.yaml",
            "service schema",
            "service documentation",
            "missing service description",
            "entity_id optional",
            "target humidity"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this PR, a new WeMo Humidifier integration was implemented as a fan platform (`homeassistant/components/fan/wemo.py`). The platform exposed a custom fan-domain service to set humidity. In code, the service was registered as `SERVICE_SET_HUMIDITY = 'wemo_set_humidity'` on the `fan` domain, with a voluptuous schema (`SET_HUMIDITY_SCHEMA`) requiring `target_humidity` (0–100 float) and allowing an optional `entity_id` list. The internal handler iterated over either the specified entities or all WeMo humidifier entities stored in `hass.data['fan.wemo']` and called `humidifier.set_humidity(target_humidity)`, which maps the requested percentage into discrete device levels (45, 50, 55, 60, 100%/Max).\n\nDespite the service being fully implemented and registered in Python, it was not declared in the `services.yaml` metadata for the `fan` component. In Home Assistant, this YAML file is used to describe services for the UI and API documentation. The missing YAML entry meant that `wemo_set_humidity` did not appear in the Services dev tool, had no autogenerated documentation, and could easily be overlooked by users.\n\nThe fix added an entry to `homeassistant/components/fan/services.yaml`:\n\n```yaml\nwemo_set_humidity:\n  description: Set the target humidity of WeMo humidifier devices.\n  fields:\n    entity_id:\n      description: Names of the WeMo humidifier entities (0 or more entities, if no entity_id is provided, all WeMo humidifiers will have the target humidity set).\n      example: 'fan.wemo_humidifier'\n    humidity:\n      description: Target humidity. This is a float value between 0 and 100, but will be mapped to the humidity levels that WeMo humidifiers support (45, 50, 55, 60, and 100/Max) by rounding the value down to the nearest supported value.\n      example: 56.5\n```\n\nThis made the `wemo_set_humidity` service discoverable and properly documented in the UI, matching the implementation in `fan/wemo.py`. No changes were needed to the logic of the service itself; the bug was purely the missing metadata declaration.",
        "semantic_memory": "When adding a custom service to a Home Assistant integration, there are two distinct parts: (1) the runtime service registration in Python (using `hass.services.register(domain, service_name, handler, schema=...)`), and (2) the static service metadata in `services.yaml` under the component's domain. The Python registration makes the service callable; the YAML description makes it discoverable, documented, and user-friendly in the developer tools and generated docs. If you forget to add the `services.yaml` entry, the service may technically work but users will have no guidance on how to call it, and tools that rely on these descriptions will be incomplete.\n\nIt is also good practice to align naming and semantics between code and YAML: the service name in Python (`wemo_set_humidity`) must match the key in `services.yaml`, and the YAML descriptions should explain parameter ranges and any internal mapping (e.g. mapping a 0–100% humidity input to discrete device levels). If a service accepts an optional `entity_id` and falls back to operating on all managed entities, this behavior should also be clearly documented.\n\nMore generally, for any integration that registers extra services beyond standard domain services, always:\n- Define a clear voluptuous schema in the code, including required and optional fields.\n- Add a corresponding entry in `services.yaml` with human-readable descriptions and examples.\n- Keep the Python service name and the YAML key in sync.\n\nThis pattern ensures that custom services are both robust at runtime and easy to discover and use.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar Home Assistant custom-service documentation issues.",
            "Step 1: Identify the service problem.\n- Observe that a custom service is callable in automation code or by direct API, but does not appear in the Home Assistant Developer Tools 'Services' list or lacks documentation.\n- Confirm by checking that calling `hass.services.has_service(domain, service_name)` returns True while the UI does not show the service.",
            "Step 2: Locate the Python service registration.\n- Open the integration's Python module (e.g. `homeassistant/components/<domain>/<platform>.py`).\n- Search for `hass.services.register` calls to find custom service names and their domains.\n- Note the service name (e.g. `'wemo_set_humidity'`), the domain (e.g. `fan.DOMAIN` or `'fan'`), and the voluptuous schema specifying fields and constraints.",
            "Step 3: Check services.yaml for metadata.\n- Navigate to `homeassistant/components/<domain>/services.yaml` (domain, not platform; e.g. `components/fan/services.yaml`).\n- Look for a top-level key matching the service name from code (`wemo_set_humidity`).\n- If it is missing or incomplete, that's likely why the service is not documented in the UI.",
            "Step 4: Add or update the services.yaml entry.\n- Under the correct domain's `services.yaml`, add an entry whose key matches the service name:\n  ```yaml\n  wemo_set_humidity:\n    description: Set the target humidity of WeMo humidifier devices.\n    fields:\n      entity_id:\n        description: Names of the WeMo humidifier entities (0 or more entities, if no entity_id is provided, all WeMo humidifiers will have the target humidity set).\n        example: 'fan.wemo_humidifier'\n      humidity:\n        description: Target humidity as a float between 0 and 100, mapped to the supported humidity levels (e.g. 45, 50, 55, 60, 100).\n        example: 56.5\n  ```\n- Ensure the YAML structure and indentation follow other examples in the file.",
            "Step 5: Verify the schema matches the implementation.\n- Cross-check the Python schema (e.g. `SET_HUMIDITY_SCHEMA = vol.Schema({...})`) with the YAML descriptions:\n  - Required vs optional fields (e.g. optional `entity_id`, required `ATTR_TARGET_HUMIDITY`).\n  - Value ranges (e.g. `vol.Range(min=0, max=100)` should be mentioned in the YAML description).\n  - Semantics like mapping continuous values to discrete device modes should be explained.",
            "Step 6: Reload and test.\n- Restart Home Assistant or reload the component (if supported).\n- Open Developer Tools → Services and confirm the new service appears under the correct domain.\n- Inspect the auto-generated field descriptions to ensure they match expectations.\n- Call the service via the UI using example data and confirm the devices behave correctly (e.g. WeMo humidifier adjusts humidity).",
            "Step 7: For new integrations, adopt this pattern proactively.\n- Whenever you add a custom service in code, create the matching `services.yaml` entry in the same PR.\n- Use clear, user-focused descriptions and include examples that reflect typical usage.\n- Document behaviors such as defaulting to all entities when `entity_id` is omitted, or internal rounding/mapping of numeric parameters."
        ]
    }
}