{
    "search_index": {
        "description_for_embedding": "Home Assistant Plex integration removed custom entity_id naming options and now relies on the Entity Registry to manage entity_ids. The config options use_custom_entity_ids and entity_namespace were removed, and instead the entity display name is set to 'Plex {device/player name}', letting the registry derive stable entity_ids from unique_id while providing a consistent Plex prefix in the UI.",
        "keywords": [
            "home-assistant",
            "plex",
            "media_player",
            "entity_id",
            "Entity Registry",
            "use_custom_entity_ids",
            "entity_namespace",
            "breaking change",
            "naming convention",
            "display name prefix"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In the Home Assistant Plex media_player integration, there was legacy support for custom entity_id naming via configuration options use_custom_entity_ids and entity_namespace. The code manually set entity_id based on the Plex machine_identifier or name, optionally with a namespace prefix. This conflicted with the newer Home Assistant guideline that integrations should not manually set entity_id but instead rely on the Entity Registry, which generates entity_ids from unique_id and the entity's name.\n\nTo align with these guidelines and simplify configuration, the PR removed the use_custom_entity_ids option from PLATFORM_SCHEMA and deleted the block that directly assigned self.entity_id based on machine_identifier and entity_namespace. Initially, the author tried to directly set entity_id to 'media_player.plex_{name}', but this was reverted because it's still manual entity_id manipulation.\n\nThe final solution was to leave entity_id management fully to the Entity Registry and instead adjust only the entity's display name. A NAME_FORMAT constant ('Plex {}') was introduced, and refresh() now sets:\n- For device-based entities: self._name = NAME_FORMAT.format(self._device.title or DEVICE_DEFAULT_NAME)\n- For session/player-based entities: self._name = NAME_FORMAT.format(self._player.title)\n\nThis results in entities having names like 'Plex Living Room TV', from which the Entity Registry will derive default entity_ids (e.g., media_player.plex_living_room_tv). Existing entities remain associated correctly because unique_id was not changed; therefore, entity registry links remain intact. The change is marked as a breaking change because the configuration options use_custom_entity_ids and entity_namespace are no longer supported, and new entities will follow the new naming convention.",
        "semantic_memory": "This fix illustrates a broader best practice for systems that have a central registry for entity identifiers (like Home Assistant's Entity Registry):\n\n1. **Do not manually manage primary identifiers once a registry exists.** When a platform provides a registry that maps stable unique_ids to user-visible entity_ids, integrations should not override entity_id directly. Doing so can interfere with user customizations, migration, and internal consistency.\n\n2. **Use unique_id for stability, name for presentation.** The stable linkage across restarts and configuration changes should come from unique_id, not from the entity_id or display name. The entity name is primarily for human readability and can be safely adjusted (e.g., adding a 'Plex' prefix) without breaking the linkage, as long as unique_id remains unchanged.\n\n3. **Provide consistent, descriptive default names instead of bespoke ID schemes.** If you want entities to be easily recognizable (e.g., all Plex players grouped together), prefer a naming convention for the display name (\"Plex {}\") rather than exposing complex config-driven ID schemes. The registry can then derive readable entity_ids from these names.\n\n4. **Deprecate legacy configuration options that duplicate registry functionality.** Once a core system handles identifier customization (like the Entity Registry), old options that control entity_id formatting (such as use_custom_entity_ids and entity_namespace) add complexity and potential bugs without real benefit. Removing them and documenting the breaking change simplifies both the code and the user mental model.\n\n5. **Preserve unique_id to avoid breaking existing entities.** When changing how names or entity_ids are derived, keep unique_id stable so that previously created entities remain associated with the same physical/device entities in the registry. This allows seamless migration to new naming behavior without forcing users to reconfigure.",
        "procedural_memory": [
            "When an integration currently sets its own entity_ids but the platform provides a central entity registry, migrate to using the registry and avoid manual entity_id assignments.",
            "Step 1: Identify any configuration options and code paths that manipulate entity_id directly (e.g., options like use_custom_entity_ids or entity_namespace). Remove or deprecate these options from the integration's configuration schema.",
            "Step 2: Search the integration code for direct assignments to self.entity_id or equivalent identifier properties. Remove these assignments so that the platform's registry remains the single source of truth for entity_ids.",
            "Step 3: Ensure every entity exposed by the integration has a stable unique_id derived from a reliable, device-specific property (e.g., machine identifier, serial number, or stable API ID). Confirm that unique_ids remain unchanged across restarts and code upgrades.",
            "Step 4: If you need more recognizable or grouped entities in the UI, adjust the entity's human-readable name instead of its entity_id. Introduce a clear name template or constant (e.g., NAME_FORMAT = 'Plex {}') and set self._name using that template in appropriate lifecycle methods (e.g., in refresh() or initialization).",
            "Step 5: Verify that existing entities are not broken: confirm that unique_ids are unchanged so the entity registry can match existing entities. Test with installations that already have entities registered to ensure they still appear and are functional after the change.",
            "Step 6: For any removed configuration options or behavior changes, mark them as breaking changes in the release notes and update documentation, explaining that entity_id customization should now be done via the Entity Registry or equivalent central mechanism.",
            "Step 7: Run the integration's test suite and add or update tests to validate that new entities receive the expected default names and that no code path attempts to override entity_id.",
            "Step 8: Communicate migration guidance to users: explain that they should now manage entity_ids and display names via the registry UI or configuration, and that old config options (like use_custom_entity_ids/entity_namespace) are no longer respected."
        ]
    }
}