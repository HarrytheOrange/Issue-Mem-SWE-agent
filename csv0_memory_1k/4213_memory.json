{
    "search_index": {
        "description_for_embedding": "Fixes Windows batch installer for PokemonGo-Bot so that user-specified install paths with forward slashes (e.g., c:/Test/) are normalized correctly, preventing malformed paths like c:/Test/\\PokemonGo-Bot that broke rmdir and git clone. Also removes bundled PyYAML wheels in favor of pip requirements, simplifies/removes runtime virtualenv usage, and hardens backup/restore of encrypt*.dll/so and config files.",
        "keywords": [
            "Windows batch",
            "install script",
            "path normalization",
            "forward slash path",
            "c:/Test/",
            "Invalid switch - \"Test\"",
            "PokemonGo-Bot",
            "encrypt.dll backup",
            "PyYAML wheel removal",
            "virtualenv usage",
            "requirements.txt",
            "rmdir invalid switch"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this PR, the Windows installer and starter batch files for PokemonGo-Bot were refactored to fix several practical issues observed by users.\n\nA key bug surfaced when a user chose an install folder like `c:/Test/`. The original script constructed paths like `c:/Test/\\PokemonGo-Bot` and used them in commands such as:\n\n- `if exist c:/Test/\\PokemonGo-Bot rmdir c:/Test/\\PokemonGo-Bot /s /q`\n\nBecause of the mixed `/` and `\\`, `rmdir` interpreted `/Test` as a switch, producing `Invalid switch - \"Test\"`, and the directory was not removed. Subsequent `git clone` then failed with `destination path 'c:/Test/\\PokemonGo-Bot' already exists and is not an empty directory.` This behavior was confirmed by comparing traces between the original batch and a user-adapted version that used `c:\\Test\\PokemonGo-Bot`.\n\nOriginally, there was a piece of logic that normalized the user-provided path, but it had been removed because it sometimes produced triple backslashes. In this PR, the author reintroduced path normalization in a safer way: immediately after reading `InstallPath` from user input, they normalize it via:\n\n`FOR /F \"tokens=1-4 delims=/-. \" %%G IN (\"%InstallPath%\") DO (set InstallPath=%%G\\%%H\\%%I)`\n\nThis converts forward slashes and certain other delimiters into standard backslash-separated segments before constructing `PGBotPath=%InstallPath%\\PokemonGo-Bot`. With this change, installations into `c:/Test/` behave like `c:\\Test\\PokemonGo-Bot`, and `rmdir` and `git clone` use valid paths.\n\nIn parallel, the PR cleaned up Python dependency handling. Two bundled PyYAML wheel files (`PyYAML-3.11-cp27-cp27m-win32.whl` and `PyYAML-3.11-cp27-cp27m-win_amd64.whl`) were removed from `windows_bat/`, and the install script now simply runs `pip2 install -r %PGBotPath%\\requirements.txt`, letting pip handle the correct wheel selection instead of manually installing a specific PyYAML wheel based on OS bitness.\n\nThe relationship with virtualenv was also adjusted. Initially, the install script created a virtualenv and activated it; later changes removed that requirement, running directly in the system Python. In the final state of this PR, the install script ensures both pip and virtualenv are up to date (`pip2 install --upgrade pip` and `pip2 install --upgrade virtualenv`), but the runtime start script (`PokemonGo-Bot-Start.bat`) no longer creates or activates a virtualenv; it simply uses git to update the repo and then runs the bot, relying on globally installed dependencies.\n\nBackup/restore behavior was hardened. Originally the script handled a generic `encrypt.` file; the new logic explicitly backs up and restores all of:\n\n- `encrypt.so`\n- `encrypt.dll`\n- `encrypt_64.dll`\n- `configs\\config.json`\n- `web\\config\\userdata.js`\n\nfrom both the bot directory and the installer directory into a dedicated `Install-Files` folder and then back into the newly cloned repo. This ensures that user configuration and platform-specific encrypt binaries survive reinstallation.\n\nMinor but related changes include enabling delayed environment variable expansion (`setlocal EnableDelayedExpansion`), fixing path separators in instructional echo messages (backslashes instead of forward slashes), and adding a short pause/instruction section at the end of the installer to guide users to the correct configuration files and the Google Maps API key documentation.",
        "semantic_memory": "This PR encodes several general lessons about Windows scripting and installer design:\n\n1. **Normalize user-supplied paths early and consistently.**\n   - Windows batch commands interpret `/` as the start of a switch, so user input like `c:/Test/` can break commands such as `rmdir` or `if exist` when used directly.\n   - A common pattern in `.bat` files is to normalize paths using a `FOR /F` loop with a set of delimiters, reconstructing a path using backslashes. This prevents invalid constructs like `c:/Test/\\PokemonGo-Bot` and eliminates the need for ad-hoc string replacements.\n\n2. **Avoid bundling platform-specific wheels if pip can resolve them.**\n   - Shipping binary wheels (e.g., specific PyYAML builds) directly in a repo adds maintenance cost and can get out-of-date quickly.\n   - If possible, prefer `pip install -r requirements.txt` and let pip resolve an appropriate wheel or source distribution for the current OS/architecture.\n\n3. **Be deliberate about virtualenv usage in CLI tooling.**\n   - For end-user scripts, mandating virtualenv can complicate the UX (especially on Windows), and mixing global and virtualenv installs can be confusing.\n   - A middle ground is to ensure `virtualenv` itself is available (so power users can still leverage it) while avoiding tightly coupling installer logic to a specific virtualenv layout.\n\n4. **Handle backup and restore of user state explicitly.**\n   - When re-cloning or re-installing a repo, it is easy to accidentally delete configuration and local assets (such as platform-specific encrypted binaries).\n   - A robust installer explicitly backs up such files to a known location and restores them after the fresh clone is complete, checking all relevant variants (`encrypt.so`, `encrypt.dll`, `encrypt_64.dll`, etc.).\n\n5. **Use delayed expansion when mutating environment variables in batch scripts.**\n   - When variables are modified inside loops, `setlocal EnableDelayedExpansion` and `!var!` notation prevent subtle bugs where `%var%` is expanded only once at parse time.\n\nThese patterns apply broadly to Windows automation scripts and installer batch files: always normalize and validate paths, prefer package managers over bundled binaries, minimize assumptions about environments (like virtualenv), and robustly protect user data across reinstalls.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar Windows batch installer issues:",
            "Step 1: Reproduce the failure with realistic user input.\n- Ask users (or yourself) to run the installer with various custom installation paths, such as `c:/Test/` or paths containing spaces.\n- Capture the console output, looking specifically for messages like `Invalid switch - \"Test\"` or git clone errors about the destination path already existing.",
            "Step 2: Inspect how paths are constructed and passed to commands.\n- Open the `.bat` file and find where the install path is read (e.g., `set /p InstallPath=...`).\n- Search for uses of that variable in commands like `if exist`, `rmdir`, `cd`, and `git clone`.\n- Check whether the code mixes forward slashes (`/`) and backslashes (`\\`) or appends segments in a way that could lead to `c:/Test/\\Something`.",
            "Step 3: Normalize the user-supplied path immediately after reading it.\n- Right after `set /p InstallPath=...`, add a normalization step that treats slashes as delimiters and rebuilds a canonical backslash path. For example:\n  - `FOR /F \"tokens=1-4 delims=/-. \" %%G IN (\"%InstallPath%\") DO (set InstallPath=%%G\\%%H\\%%I)`\n- Then construct derived paths like `set PGBotPath=%InstallPath%\\MyApp` using this normalized value.\n- Re-run the installer with forward-slash paths to confirm that `rmdir` and other commands no longer treat segments as switches.",
            "Step 4: Remove or modernize bundled binary wheels.\n- Search the repo for `.whl` files and any `pip install` lines that reference them directly.\n- If the package is already declared in `requirements.txt`, delete the wheels and replace manual wheel installs with a single `pip install -r path\\to\\requirements.txt`.\n- Test on both 32-bit and 64-bit Windows (or at least verify via CI) to confirm pip resolves appropriate wheels or falls back to source builds.",
            "Step 5: Decide on the virtualenv strategy and keep scripts consistent.\n- If you want to run inside virtualenv, ensure your install script consistently:\n  - Installs/updates virtualenv (`pip install --upgrade virtualenv`).\n  - Creates the environment (`virtualenv .`) and activates it before installing requirements.\n- If you want to simplify for end users, remove the virtualenv creation/activation steps from both install and start scripts, and just use global `pip install -r requirements.txt`.\n- Avoid a mixed state where some scripts assume virtualenv and others do not.",
            "Step 6: Implement robust backup/restore of user-critical files.\n- Identify files that users will have customized or that are hard to regenerate: configuration JSON, web UI configuration, binary blobs (like `encrypt.so` / `.dll`).\n- Before removing or re-cloning the application directory, copy these files into a backup directory (e.g., `Install-Files`) and/or alongside the installer:\n  - `if exist %AppPath%\\encrypt.so COPY %AppPath%\\encrypt.so %DownPath%`\n  - Repeat for all relevant variants and config files.\n- After cloning the fresh repo and installing dependencies, restore backups in order of priority (installer dir first, then backup dir) to the correct locations under the new tree.",
            "Step 7: Use delayed expansion when variables are changed in loops.\n- If you manipulate variables inside `FOR` loops, wrap the script with `setlocal EnableDelayedExpansion` and access such variables as `!Var!` instead of `%Var%`.\n- This prevents bugs where values appear not to change due to expansion-time semantics in batch files.",
            "Step 8: Add clear user-facing instructions and verification steps.\n- At the end of the installer, echo the exact paths of critical config files (e.g., `%PGBotPath%\\configs\\config.json`, `%PGBotPath%\\web\\config\\userdata.js`).\n- Provide links to documentation (e.g., how to configure Google Maps API keys).\n- Optionally, add a `PAUSE` so users can read the instructions before the console window closes.",
            "Following these steps will help you debug and harden Windows batch-based installers: normalize paths, rely on pip for dependencies, make a clear decision about virtualenv, and protect user state during upgrades."
        ]
    }
}