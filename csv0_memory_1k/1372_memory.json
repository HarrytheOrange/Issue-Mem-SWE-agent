{
    "search_index": {
        "description_for_embedding": "Introduced a st2_bootstrap.sh wrapper script that serves as a single entry point for StackStorm deployments. The script resolves a requested version alias (stable, latest, or explicit version), detects the OS family (Debian vs. RHEL), constructs the correct versioned st2_deploy.sh URL on the download server, verifies it exists, downloads it to a temp location, makes it executable, and then runs it. This preserves backwards compatibility while allowing per-version deployment scripts.",
        "keywords": [
            "StackStorm",
            "st2_bootstrap.sh",
            "st2_deploy.sh",
            "deployment script wrapper",
            "versioned deploy scripts",
            "stable vs latest alias",
            "OS detection",
            "bash",
            "curl",
            "backwards compatibility"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this PR, the team needed a clean way for users to install StackStorm using a single entry point while supporting multiple deployment script versions and aliases like 'stable' and 'latest'. Previously, st2_deploy.sh itself was the main entry point, but they wanted version-specific deployment scripts to live under a /scripts/ path on the download server without breaking existing usage patterns.\n\nTo achieve this, they introduced tools/st2_bootstrap.sh. This script:\n- Accepts an argument that can be 'stable', 'latest', or an explicit version.\n- Resolves 'stable' and 'latest' by scraping the appropriate APT repository directories for st2api .deb filenames (trusty_stable and trusty_unstable pools) and extracting the version component.\n- Defaults to a specific version (0.8.3) if no argument is provided.\n- Detects the OS family by checking lsb_release (for Debian/Ubuntu) and /etc/redhat-release (for RHEL-like systems) and sets a TYPE flag ('debs' or 'rpms').\n- Constructs the URL to the versioned deployment script: BASE_URL/<version>/<TYPE>/st2_deploy.sh.\n- Uses curl with a HEAD request to verify that the script exists; if it does not, it prints an error about an unknown version and exits.\n- If the URL is valid, downloads the st2_deploy.sh script into /tmp/st2_boostrap.sh (a temp file name, consistently used even though 'bootstrap' is misspelled), makes it executable, and then executes it passing along the resolved version.\n\nThis gives StackStorm one stable, user-facing \"bootstrap\" script that maps user-friendly inputs ('stable', 'latest', specific version) to concrete deployment scripts, enabling them to update deployment logic for individual versions independently, without impacting others. There was some discussion among maintainers about the extra layer of indirection, but they accepted the design to meet the requirements of backward compatibility, easy user entry points, and independent versioned deployments.",
        "semantic_memory": "This PR illustrates a common deployment pattern: using a thin, stable bootstrap wrapper as the single user-facing entry point, which then dynamically selects and invokes version-specific logic.\n\nKey generalizable concepts:\n- **Single stable entry point:** Instead of having users directly invoke a versioned or relocatable script, expose a stable bootstrap (e.g., install.sh or bootstrap.sh) whose behavior can evolve internally while its public interface stays stable.\n- **Version resolution via aliases:** The bootstrap script can support human-friendly aliases (like 'stable' and 'latest') and explicit versions. Internally it resolves these aliases to concrete versions (e.g., by querying a package repository, an API, or a manifest file).\n- **OS/distro detection:** Installation/bootstrap scripts should detect the underlying OS family (Debian vs RHEL, Windows vs Linux, etc.) and branch logic accordingly, choosing the correct binary or package format.\n- **Remote script fetching with validation:** Before executing a remote script, verify its existence (e.g., via an HTTP HEAD request) and handle missing versions gracefully with a clear error instead of failing mid-execution.\n- **Decoupling per-version scripts:** By hosting per-version deployment scripts at well-defined URLs (e.g., BASE_URL/<version>/<platform>/deploy.sh) and having the bootstrap just pick and run them, maintainers can change the deployment logic for one version without altering others.\n\nThis pattern is broadly applicable to CLI installers, SaaS agents, SDK installers, and any system where you need to maintain backward-compatible installation or upgrade flows across multiple versions and platforms.",
        "procedural_memory": [
            "To design and implement a robust multi-version deployment entry point similar to this case:",
            "Step 1: Identify user-facing entry points and compatibility requirements.",
            "Clarify what the user-facing command or URL should be (e.g., curl https://example.com/install.sh | bash) and what inputs it should accept (e.g., no argument = default version, 'stable', 'latest', explicit versions). Document expectations around backward compatibility.",
            "Step 2: Decide how to map aliases ('stable', 'latest') to concrete versions.",
            "Choose a mechanism to resolve symbolic version aliases. Options include: querying a package repository index (like an APT or yum repo), calling an internal API that returns the current stable/latest tags, or reading from a version manifest stored on your server. Implement this logic in the bootstrap script.",
            "Step 3: Implement OS/distro detection.",
            "Add detection logic at the start of the bootstrap script to identify the OS family. For Linux, common patterns include using lsb_release or /etc/os-release for Debian/Ubuntu, and /etc/redhat-release or /etc/centos-release for RHEL/CentOS. Map these to platform identifiers (e.g., debs vs rpms) that will be used to build correct URLs or package names.",
            "Step 4: Construct versioned script URLs or artifact paths.",
            "Define a consistent URL or path scheme for versioned deployment scripts, such as BASE_URL/<version>/<platform>/deploy.sh. In the bootstrap, use the resolved version and platform type to construct the final download URL for the per-version deployment script.",
            "Step 5: Validate the remote resource before executing.",
            "Use a lightweight HTTP HEAD request (e.g., curl --head --fail) or an equivalent to verify that the remote script exists. If the request fails, print a clear error like 'Unknown version: <version>' and exit with a non-zero status so automation can detect the failure.",
            "Step 6: Download to a temporary file and ensure correct permissions.",
            "If the resource exists, download it to a temporary path (e.g., /tmp/tool_bootstrap.sh). Ensure you handle errors from curl and set executable permissions (chmod +x) on the downloaded file. Consider using mktemp for safer temp file handling.",
            "Step 7: Execute the downloaded script with appropriate arguments.",
            "Run the downloaded version-specific deployment script in a subshell (e.g., bash /tmp/deploy.sh <version>). Pass along any necessary arguments, such as the resolved version or additional user flags. Optionally, clean up the temp file afterward.",
            "Step 8: Log key actions for observability.",
            "Print informative messages, such as the detected OS, the resolved version, and the URL from which you're downloading the deployment script. This makes it easier for users and operators to diagnose issues when things go wrong.",
            "Step 9: Test across OS types and version inputs.",
            "Test the bootstrap end-to-end on all supported platforms (Debian/Ubuntu, RHEL/CentOS, etc.) using different inputs: no argument (default), 'stable', 'latest', and a few specific versions. Confirm that the bootstrap fails gracefully when a version does not exist or the OS is unsupported.",
            "Step 10: Maintain alias logic and per-version scripts going forward.",
            "When releasing new versions, update whichever mechanism is used to define 'stable' and 'latest'. Upload or publish the corresponding per-version deployment scripts at the expected URLs so the bootstrap continues to work without modification across releases."
        ]
    }
}