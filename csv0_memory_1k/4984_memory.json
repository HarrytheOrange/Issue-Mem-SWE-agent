{
    "search_index": {
        "description_for_embedding": "Deprecated CentOS/RHEL 6 support by removing EL6 build targets and CI jobs, and dropping sysv init support from service management scripts, leaving only systemd and upstart as supported init systems.",
        "keywords": [
            "CentOS 6",
            "RHEL 6",
            "EL6 deprecation",
            "rpm packaging",
            "CircleCI config",
            "Makefile rhel-rpm",
            "sysv init",
            "systemd",
            "upstart",
            "st2actions runners.sh",
            "st2common st2ctl",
            "init system detection",
            "platform support removal"
        ]
    },
    "agent_memory": {
        "episodic_memory": "The project decided to deprecate and remove support for CentOS/RHEL 6 (EL6). This required changes across CI, packaging, and runtime scripts.\n\nIn the CI configuration (.circleci/config.yml), EL6 was removed from the DISTROS build matrix (previously \"xenial bionic el6 el7 el8\", now \"xenial bionic el7 el8\"), and CircleCI parallelism for the packages job was reduced from 5 to 4 to match the fewer targets.\n\nIn the root Makefile and various component Makefiles (st2actions, st2api, st2auth, st2debug, st2reactor, st2stream, st2tests, and st2client), the special rhel-rpms / rhel-rpm targets that built EL6-specific RPMs using *-rhel6.spec files were removed. Regular rpm targets for EL7+ remain untouched. This eliminates EL6-specific packaging paths while keeping generic RPM builds.\n\nRuntime scripts were also updated to align with the dropped platform. In st2actions/bin/runners.sh, the init system detection logic previously supported systemd, upstart, and a sysv fallback (with a special case for Debian containers). That sysv branch was removed entirely. The script now only recognizes systemd (via systemctl) and upstart (via initctl), and if neither is detected it exits with an error: \"Unknown platform, we support ONLY upstart and systemd!\" The sysv-based start command logic for workers was removed as well.\n\nSimilarly, in st2common/bin/st2ctl, the service_manager function used to try: systemctl, then initctl, then \"service\", and finally an explicit /etc/init.d/<svc> sysv script. The explicit init.d fallback and mention of sysv in the error message were removed. Now if neither systemd, upstart, nor the generic 'service' command can handle the service, it errors with: \"Unknown service manager, we ONLY support systemd and upstart!\"\n\nThe CHANGELOG.rst was updated multiple times to properly document the change under the \"Removed\" section as: \"Removed `CentOS 6`/`RHEL 6` support #4984\", crediting the contributor. There was also discussion noting that a related repository (st2-packages) would be updated in a separate PR to remove EL6/sysv references there.\n\nOverall, the incident was a coordinated cleanup: eliminate EL6 RPM builds and CI jobs, remove sysv init assumptions from core scripts, and clearly document that only newer platforms (with systemd or upstart) are supported.",
        "semantic_memory": "When a platform or OS version is deprecated (e.g., CentOS/RHEL 6), support must be removed consistently across:\n\n1. **CI and build matrices**: Any mention of the deprecated platform in CI configs (e.g., CircleCI DISTROS lists) must be removed to avoid unnecessary builds, slowed pipelines, or false expectations of support.\n\n2. **Packaging and build scripts**: Platform-specific build targets and spec files (e.g., Makefile targets like `rhel-rpm` that rely on `*-rhel6.spec`) must be cleaned up. Keeping them around can mislead contributors into thinking the old platform is still supported and may cause broken or unmaintained package builds.\n\n3. **Runtime/platform detection logic**: Code that dynamically selects behavior based on OS or init system (systemd, upstart, sysv, etc.) needs to be updated to drop branches that only exist for deprecated platforms. Continuing to support old init systems like sysv can create maintenance and testing burden, and may obscure errors on unsupported environments.\n\n4. **Error messaging and documentation**: Once support is dropped, error messages should clearly list only the supported systems. Clear, strict messaging (e.g., \"we ONLY support systemd and upstart\") prevents users from assuming legacy setups are still acceptable.\n\n5. **Cross-repo consistency**: In multi-repo systems, removing platform support in one repo (core) while retaining it in another (packages, installers) leads to inconsistency. Coordinated changes or follow-up PRs in related repositories are required.\n\n6. **Fail-fast behavior**: Removing fallback branches for unsupported platforms forces the system to fail early with explicit errors when run on an environment that is no longer supported, which is preferable to implicit, partial, or undefined behavior.\n\nIn general, platform deprecation is not just a documentation change; it is a code and infrastructure change touching CI, packaging, init/boot integration, and user-facing tooling. A systematic search and removal of references and code paths is required to avoid confusing or fragile behavior.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Identify the deprecated platform and scope of support.\n- Determine which OS/version or environment is being dropped (e.g., CentOS/RHEL 6).\n- Clarify what aspects are affected: packaging, CI builds, runtime scripts, init systems, etc.",
            "Step 2: Search for references to the deprecated platform across the codebase.\n- Grep for terms like \"el6\", \"rhel6\", \"centos6\", \"sysv\", or any platform-specific identifiers.\n- Check CI configs (CircleCI, GitHub Actions, Jenkins), packaging scripts (Makefiles, spec files, Dockerfiles), and service management scripts.",
            "Step 3: Update CI configurations.\n- Remove the deprecated platform from build matrices (e.g., update DISTROS lists in CI YAML files).\n- Adjust parallelism or resource usage if the number of build targets changes.\n- Ensure no CI jobs or workflows still reference the deprecated platform.",
            "Step 4: Clean up packaging/build targets.\n- Remove platform-specific Makefile targets that build deprecated platform packages (e.g., `rhel-rpm` targets that used `*-rhel6.spec`).\n- Delete or decommission any spec files or packaging configs that are only relevant to the deprecated platform.\n- Keep generic or newer-platform targets (e.g., `rpm` for EL7+) intact.",
            "Step 5: Simplify runtime platform and init-system detection.\n- Review scripts that detect init systems or OS types (e.g., systemd vs upstart vs sysv).\n- Remove branches that only exist to support the deprecated platform (e.g., sysv fallbacks for EL6).\n- Ensure the remaining logic handles only supported systems (e.g., systemd and upstart) and that any unsupported case results in a clear, immediate error.",
            "Step 6: Update service management helpers.\n- For wrapper scripts like `st2ctl` (or similar service control scripts), remove explicit init.d/sysv fallbacks if the platform that required them is no longer supported.\n- Update error messages to accurately list only supported service managers (e.g., \"we ONLY support systemd and upstart\").",
            "Step 7: Ensure cross-repo consistency.\n- If there are related repositories (e.g., core vs packages), identify corresponding references and open PRs or issues to remove the deprecated platform support there as well.\n- Cross-link issues/PRs so the deprecation is tracked as a coordinated effort.",
            "Step 8: Document the removal clearly.\n- Add entries to the CHANGELOG under a \"Removed\" (or similar) section, explicitly stating that support for the platform (e.g., `CentOS 6`/`RHEL 6`) has been removed.\n- Optionally, reference the issue/PR number and credit contributors.\n- If there is a deprecation policy or support matrix, update it.",
            "Step 9: Validate behavior on supported platforms.\n- Run CI and verify that all remaining build targets (e.g., EL7/EL8, Ubuntu releases) pass.\n- Test the service management scripts on supported init systems to ensure that dropping the old branches did not break systemd/upstart flows.",
            "Step 10: Communicate and enforce the change.\n- Communicate to maintainers and users that the old platform is no longer supported.\n- If new issues arise from users on the deprecated platform, point to the removal and recommend upgrading to supported OS versions instead of reintroducing legacy code paths."
        ]
    }
}