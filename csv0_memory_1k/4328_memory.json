{
    "search_index": {
        "description_for_embedding": "Z-Wave climate integration had missing setpoint index label mappings (e.g., Comfort, Energy Saving, Direct Valve Control), causing some thermostats like StellaZ to not map their setpoint modes correctly. The fix adds the missing labels to the SET_TEMP_TO_INDEX dictionary so all reported mode labels map to the proper Z-Wave index values.",
        "keywords": [
            "Z-Wave",
            "zwave climate",
            "thermostat",
            "setpoint index",
            "SET_TEMP_TO_INDEX",
            "missing index labels",
            "Comfort mode",
            "Energy Saving mode",
            "Direct Valve Control",
            "StellaZ thermostat",
            "mapping bug",
            "Home Assistant"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In the Home Assistant Z-Wave climate component, a thermostat-specific issue surfaced: certain Z-Wave thermostats (notably the StellaZ) reported setpoint modes using labels that were not present in the internal mapping dictionary `SET_TEMP_TO_INDEX`. This dictionary maps human-readable mode labels (e.g., 'Heat', 'Cool') to numeric Z-Wave setpoint indices. The existing code only covered a subset of possible labels, so when devices reported modes like 'Comfort', 'Energy Saving', or 'Direct Valve Control', the integration had no corresponding mapping. As a result, those modes could not be controlled or interpreted correctly.\n\nThe fix was to extend the `SET_TEMP_TO_INDEX` mapping in `homeassistant/components/climate/zwave.py` by adding the missing labels and mapping them to the correct underlying indices:\n- Map 'Comfort' to index 1 (same as 'Heat')\n- Map 'Energy Saving' to index 11 (same as 'Heat Econ')\n- Map 'Direct Valve Control' to index 31\n\nThis change preserves all existing mappings and simply augments the set, ensuring that when a thermostat reports one of these labels, the climate component correctly resolves it to a valid Z-Wave setpoint index. The solution was tested and confirmed working by the user who reported the issue.",
        "semantic_memory": "When integrating with external protocols or devices (such as Z-Wave thermostats), human-readable labels reported by devices must be consistently mapped to internal identifiers (such as numeric indices or enums). Bugs often occur when the mapping table is incomplete, even if the protocol technically supports a broader set of modes or values.\n\nKey concepts:\n- Mapping tables (e.g., dictionaries from label strings to numeric codes) must cover all variants used in the field, including vendor-specific or less common labels.\n- Some modes may be semantically equivalent or intentionally share the same underlying index (e.g., 'Comfort' and 'Heat' both mapping to index 1, or 'Energy Saving' and 'Heat Econ' both mapping to index 11). Leveraging these equivalences avoids code duplication and maintains compatibility.\n- Backwards-compatible fixes often simply extend existing mappings rather than changing existing values, reducing the risk of regressions.\n- User-reported device behavior (from logs or UI) can reveal missing mapping entries: if a mode is visible in the device docs or UI but not handled by the code, a missing mapping is a likely cause.\n\nMore generally, for protocol integrations:\n- Align the codeâ€™s mapping tables with official protocol specifications and real device behavior.\n- Treat label handling as case-sensitive or normalized according to the protocol or library conventions.\n- Plan for extensibility: design the mapping so adding new labels is straightforward and low risk.",
        "procedural_memory": [
            "When encountering issues where a device mode or state is not recognized or not working as expected, suspect missing or incorrect mapping between device-reported labels and internal indices or enums.",
            "Step 1: Reproduce and observe the issue.\n- Use logs or debug output from the integration to capture the exact mode labels or values received from the device (e.g., Z-Wave value labels such as 'Comfort', 'Energy Saving').\n- Confirm which actions (e.g., setting a mode or temperature) fail or behave unexpectedly.",
            "Step 2: Inspect the mapping logic.\n- Locate the mapping structure in the code (e.g., a dictionary like `SET_TEMP_TO_INDEX` in the Z-Wave climate component).\n- Check if the device-reported label exists as a key in the mapping.\n- Verify that each label is mapped to a valid internal index or enum value per the protocol documentation.",
            "Step 3: Cross-check with protocol and device documentation.\n- Consult the Z-Wave command class or vendor documentation to determine the correct index for the missing mode label.\n- Identify if the new label is an alias of an existing mode (e.g., 'Energy Saving' vs 'Heat Econ').",
            "Step 4: Extend the mapping safely.\n- Add new entries to the mapping for each missing label, mapping them to the correct indices.\n- Where appropriate, map aliases to the same index as an existing mode, rather than introducing new logic.\n- Do not modify existing mappings unless they're clearly incorrect; prefer additive changes to avoid regressions.",
            "Step 5: Test with affected devices.\n- Restart or reload the integration and verify that the previously unrecognized modes now map correctly.\n- Change the thermostat modes through the UI and confirm that the backend receives and interprets them properly.\n- If possible, have the reporting user (or a test device owner) confirm correct behavior in real-world use.",
            "Step 6: Harden and generalize.\n- Add comments or documentation noting that certain labels are aliases (e.g., 'Comfort' uses the same index as 'Heat').\n- Consider adding logging when an unknown label is encountered, to make future missing mappings easier to diagnose.\n- If the protocol defines an enumerated set of modes, consider generating the mapping from a shared reference to keep it consistent across components."
        ]
    }
}