{
    "search_index": {
        "description_for_embedding": "Home Assistant 0.75.1 hotfix: DHT22 / DHT sensor platform was broken because the dependency Adafruit_Python_DHT==1.3.2 would no longer install and the library had been renamed to Adafruit-DHT. The fix switches the sensor.dht REQUIREMENTS to Adafruit-DHT==1.3.3, updates requirement generation to skip this package in CI, and comments it in requirements_all. Additionally, rfxtrx PT2262 devices were incorrectly matched when masked_id was None; the fix adds a None check before comparing masked_id. Also bumps the frontend to 20180804.0 and increments HA version to 0.75.1.",
        "keywords": [
            "Home Assistant",
            "sensor.dht",
            "DHT22",
            "Adafruit_Python_DHT",
            "Adafruit-DHT",
            "dependency rename",
            "pip install error",
            "ImportError Raspberry_Pi_2_Driver",
            "rfxtrx",
            "PT2262",
            "device id matching",
            "None check",
            "frontend bump",
            "version 0.75.1"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In Home Assistant 0.75, users reported that the DHT22 sensor integration stopped working. Logs showed stack traces coming from the Adafruit_Python_DHT package, including an ImportError: `cannot import name 'Raspberry_Pi_2_Driver'`. The underlying cause was that the original dependency `Adafruit_Python_DHT==1.3.2` was broken and would not install anymore; upstream had effectively replaced it with a new package name and version (`Adafruit-DHT==1.3.3`). This meant Home Assistant's DHT platform was pinned to a dead/renamed library.\n\nThe fix in this PR changes the DHT sensor component's REQUIREMENTS from `Adafruit_Python_DHT==1.3.2` to `Adafruit-DHT==1.3.3` in `homeassistant/components/sensor/dht.py`. To keep CI green (because this package still needs pyx/compiled support), the dependency is commented out in `requirements_all.txt` and the automated requirements generator `script/gen_requirements_all.py` is updated to treat `Adafruit-DHT` as a skip-only dependency, similar to other platform-specific libs. This lets runtime installations on appropriate hardware succeed without breaking universal CI.\n\nIn the same patch set, another bug affected the rfxtrx integration for PT2262 devices. The function `get_pt2262_device` iterated over `RFX_DEVICES` and compared `device.masked_id` to a computed id. If `masked_id` was None, the equality comparison and matching logic could cause incorrect matches or errors. The fix adds a guard condition `device.masked_id is not None` before comparing `device.masked_id` to the computed PT2262 device id.\n\nFinally, the release bumps the frontend requirement from `home-assistant-frontend==20180803.0` to `20180804.0` and increments the core version constant from 0.75.0 to 0.75.1, packaging these fixes as a patch release.",
        "semantic_memory": "This incident illustrates two common patterns in maintaining integrations dependent on third-party Python libraries:\n\n1. **Handling upstream package renames and breakage**: When an upstream library is renamed (e.g., `Adafruit_Python_DHT` to `Adafruit-DHT`) or a pinned version becomes uninstallable, any integration relying on that exact name/version will fail at install or runtime. Robust systems should:\n   - Avoid over-constraining versions unless necessary.\n   - Monitor upstream projects for renames/deprecations and update REQUIREMENTS promptly.\n   - Distinguish between runtime-only, platform-specific dependencies (which may require compilation on specific hardware) and the global dependency set used in CI or generic builds.\n   - Use tools (like a requirements generator) that allow exclusions or annotations for such platform-specific packages.\n\n2. **Defensive attribute usage in dynamic device registries**: In device registries like rfxtrx's `RFX_DEVICES`, not all registered device objects are guaranteed to have fully populated attributes (e.g., `masked_id`). Matching logic must guard against `None` or missing attributes before comparisons. A simple `is not None` check can prevent incorrect matches and subtle bugs when multiple devices are present.\n\nMore generally:\n- When external hardware integrations begin throwing import or driver-related errors, check for dependency renames or build issues rather than only configuration mistakes.\n- For matching logic across collections of devices, always ensure attributes used as keys or identifiers are validated (non-null, correct type) before comparisons.\n- For CI that targets generic environments (like non-Raspberry Pi Linux), platform-specific libraries that need native extensions should be treated specially (skipped, mocked, or optional) to avoid build failures while still being installed on end-user systems that meet the hardware requirements.",
        "procedural_memory": [
            "When a hardware integration suddenly fails with import errors or missing drivers after an upgrade, suspect dependency changes or breakage in the upstream Python packages.",
            "Step 1: Reproduce and inspect logs.\n- Enable debug logs if necessary.\n- Look for tracebacks around the component in question (e.g., `homeassistant.components.sensor.dht`).\n- Identify the exact ImportError or installation error (e.g., `ImportError: cannot import name 'Raspberry_Pi_2_Driver'` from an Adafruit library).",
            "Step 2: Identify the dependency and its version.\n- Inspect the component's REQUIREMENTS (e.g., in `homeassistant/components/sensor/dht.py`).\n- Note the pinned package name and version (`Adafruit_Python_DHT==1.3.2`).\n- Confirm where the package is referenced in global requirements (e.g., `requirements_all.txt` and any requirements generator scripts).",
            "Step 3: Check upstream library status.\n- Visit the library's GitHub/PyPI page.\n- Look for issues indicating installation breakage, renames, or deprecation (e.g., an issue like Adafruit_Python_DHT #99).\n- Confirm the new canonical package name and version (e.g., `Adafruit-DHT==1.3.3`).",
            "Step 4: Update the integration to use the correct dependency.\n- Change the component's REQUIREMENTS to the new package name and stable version (e.g., `REQUIREMENTS = ['Adafruit-DHT==1.3.3']`).\n- If you have a centralized requirements file, update or comment out the old entry and add a commented new entry if it's platform-specific.\n- If you use an auto-generator (like `script/gen_requirements_all.py`), update its skip list or handling so that platform-specific compiled dependencies are not forced in generic CI environments (e.g., replace 'Adafruit_Python_DHT' with 'Adafruit-DHT' in the skip list).",
            "Step 5: Handle CI and platform-specific concerns.\n- If the dependency requires C extensions or hardware-specific headers, ensure your CI does not attempt to compile it on unsupported platforms.\n- Use comments or skip-lists in requirements_all to make it clear that this dependency is only meant for real hardware installations.",
            "Step 6: Add defensive checks for matching logic in device registries.\n- For code that iterates over device objects and compares ID-related attributes (e.g., `device.masked_id == computed_id`), ensure that those attributes are not None and exist.\n- Add guards like `device.masked_id is not None` before performing comparisons.\n- This prevents false-positive matches or exceptions when some device instances are partially initialized.",
            "Step 7: Test the fixes.\n- On actual target hardware (e.g., Raspberry Pi), install the updated package (`pip install Adafruit-DHT==1.3.3`) and verify that the integration (DHT22 sensor) now initializes and reports data correctly.\n- For the rfxtrx fix, test that PT2262 devices are matched correctly and that devices without `masked_id` are ignored without raising errors.",
            "Step 8: Bump versions and document.\n- If these changes fix user-facing breakages, increment the patch version (e.g., 0.75.0 â†’ 0.75.1).\n- Update any frontend or related component versions as needed.\n- Include release notes that clearly state: the DHT dependency was updated due to upstream breakage, and rfxtrx PT2262 matching was corrected."
        ]
    }
}