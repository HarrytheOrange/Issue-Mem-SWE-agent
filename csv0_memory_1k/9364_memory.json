{
    "search_index": {
        "description_for_embedding": "Home Assistant macOS launchd service could not find the `arp` command needed by the braviatv platform because `/usr/sbin` was missing from the PATH in `launchd.plist`. The fix was to extend the PATH in the launchd configuration to include `/usr/sbin` (and note that similar tools like `ping` may live in `/sbin`).",
        "keywords": [
            "PATH issue",
            "environment variables",
            "macOS launchd",
            "launchd.plist",
            "Home Assistant",
            "braviatv platform",
            "arp command not found",
            "system binaries path",
            "/usr/sbin",
            "/sbin",
            "service cannot find command",
            "daemon PATH configuration"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this incident, the Home Assistant `braviatv` platform required the `arp` command to complete its configuration. On macOS 10.10, `arp` resides in `/usr/sbin`. However, the Home Assistant macOS launchd service was started via `homeassistant/scripts/macos/launchd.plist`, where the `EnvironmentVariables` section set PATH only to `/usr/local/bin/:/usr/bin:$PATH`. Because `/usr/sbin` was missing from this PATH, the service process could not locate `arp` (and similarly, other system tools like `ping` which may live in `/sbin`). The pull request modified `launchd.plist` to extend the PATH value from `/usr/local/bin/:/usr/bin:$PATH` to `/usr/local/bin/:/usr/bin:/usr/sbin:$PATH`. After this change, the launchd-managed Home Assistant process inherited a PATH that included `/usr/sbin`, allowing it to find `arp` and complete the braviatv configuration successfully. Discussion also pointed out that `/sbin` might be needed for `ping`-based components, reinforcing the general need to include common system binary directories in service PATHs.",
        "semantic_memory": "System services and background daemons often run with a minimal or non-interactive environment, so their PATH and other environment variables can differ significantly from those in a userâ€™s shell. When an application or integration depends on external system commands (e.g., `arp`, `ping`, `ifconfig`), those commands may live in directories like `/usr/sbin` or `/sbin` that are not included in the default PATH of a service started by launchd, systemd, or other init systems. This mismatch frequently manifests as 'command not found' errors inside the application even though the command works fine in a user terminal. A robust configuration explicitly defines PATH (and possibly other environment variables) in the service configuration, including standard system binary directories such as `/usr/local/bin`, `/usr/bin`, `/usr/sbin`, and `/sbin`. For cross-platform software, it is important to recognize that binary locations vary by OS and version, and macOS in particular separates some administrative tools into `/usr/sbin` and `/sbin`. The general best practice is: if your application depends on system utilities, either (1) configure an explicit PATH in the service definition that includes the necessary directories, or (2) refer to the tools by their absolute paths, or (3) provide configuration options to override command paths.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Observe and capture the error:\n- Run the affected feature (e.g., a platform or sensor that uses a system command) and look for errors such as 'command not found', 'No such file or directory', or stack traces indicating failure to execute an external tool like `arp` or `ping`.\n- Confirm the problem only affects the service/daemon and not the same command run via an interactive shell.",
            "Step 2: Verify command availability on the host system:\n- In a terminal as the same user (if possible), run `which <command>` and `type <command>` (e.g., `which arp`, `which ping`).\n- Note the absolute path (e.g., `/usr/sbin/arp`, `/sbin/ping`) and confirm the binary exists with `ls` and has execute permissions.",
            "Step 3: Compare PATH in shell vs service environment:\n- In the terminal, run `echo $PATH` to see your interactive shell PATH.\n- For launchd or other service managers, either:\n  - Inspect the service configuration file for an explicit PATH (e.g., `launchd.plist`, systemd unit file, etc.), or\n  - Add a small diagnostic command to the service startup (e.g., write `$PATH` to a log file) to see the runtime PATH.\n- Identify whether directories like `/usr/sbin` or `/sbin` are missing from the service PATH.",
            "Step 4: Update the service configuration to include required binary directories:\n- For macOS launchd:\n  - Open the relevant `launchd.plist` (e.g., `homeassistant/scripts/macos/launchd.plist`).\n  - Locate the `<key>EnvironmentVariables</key>` section and the `<key>PATH</key>` value.\n  - Add the missing directories to the PATH string, e.g. change `/usr/local/bin/:/usr/bin:$PATH` to `/usr/local/bin/:/usr/bin:/usr/sbin:/sbin:$PATH` (as appropriate for your needs).\n- For systemd:\n  - Edit the unit file or drop-in with `Environment=PATH=/usr/local/bin:/usr/bin:/usr/sbin:/sbin` or `EnvironmentFile` pointing to a file containing PATH.\n- For other init systems, use their equivalent mechanism to set environment variables for the service.",
            "Step 5: Reload and restart the service:\n- On macOS launchd, unload and load the plist (e.g., `launchctl unload` then `launchctl load`), or reboot if necessary.\n- On systemd, run `systemctl daemon-reload` and `systemctl restart <service>`.\n- Ensure the updated PATH is effective by checking logs or adding a temporary debug log of `$PATH` in the application.",
            "Step 6: Re-test the affected functionality:\n- Invoke the previously failing feature (e.g., braviatv configuration, ping-based sensors) and verify that the external command now runs without error.\n- Check logs for the absence of 'command not found' and confirm the integration/platform completes its setup.",
            "Step 7: Generalize and harden the solution:\n- Document the PATH requirements and any external command dependencies in project documentation or comments.\n- Consider making binary locations configurable instead of hard-coding command names, so users on different OSes can adjust paths.\n- For cross-platform code, avoid relying on implicit PATH when possible; use absolute paths to known tools or bundle required utilities when feasible.\n- When adding new features that call system commands, proactively verify where those binaries live on supported platforms and update service configurations accordingly."
        ]
    }
}