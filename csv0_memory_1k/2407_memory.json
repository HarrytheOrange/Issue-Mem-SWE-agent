{
    "search_index": {
        "description_for_embedding": "Added YAML-based service descriptions for the Home Assistant persistent_notification.create service, wiring services.yaml into hass.services.register so the frontend and service docs can display field descriptions and examples.",
        "keywords": [
            "Home Assistant",
            "persistent_notification",
            "service description",
            "services.yaml",
            "hass.services.register",
            "load_yaml_config_file",
            "frontend documentation",
            "service schema",
            "metadata"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this change set, the persistent_notification component in Home Assistant was enhanced to provide a structured service description for its `create` service. Previously, the `persistent_notification` service existed but had no formal description metadata wired into the system, so the UI and service documentation could not present helpful descriptions or examples for its fields.\n\nThe fix introduced a new `homeassistant/components/services.yaml` file, which defines service metadata for the `persistent_notification` domain. The YAML structure was refined across two commits: initially, the description and fields were directly under `persistent_notification`, then updated to nest them under `persistent_notification: create:` to reflect the specific service name.\n\nThe Python module `homeassistant/components/persistent_notification.py` was modified to import `os` and `load_yaml_config_file`, load `services.yaml` at setup time, and pass the relevant description block into `hass.services.register`. Originally, it called `descriptions.get(DOMAIN)`; this was corrected to index into the nested YAML structure as `descriptions[DOMAIN][SERVICE_CREATE]` to match the new schema.\n\nThe YAML now documents three fields for the `persistent_notification.create` service: `message` (message body, templates accepted), `title` (optional title, templates accepted), and `notification_id` (optional identifier to replace an existing notification with the same ID). Local tests via `tox` were reported as passing.",
        "semantic_memory": "This change illustrates a pattern for integrating declarative service documentation with runtime service registration in Home Assistant or similar systems.\n\nKey concepts:\n- **Externalized service metadata**: Service descriptions, including field descriptions and examples, can be stored in a YAML file instead of being hard-coded. This makes them easier to maintain, localize, and consume by tooling (e.g., frontend UIs, docs generators).\n- **Consistent structure between config and code**: The YAML structure (`domain -> service -> description/fields`) must align with how the code indexes into the loaded configuration (here, `descriptions[DOMAIN][SERVICE_CREATE]`). Any mismatch between nesting in YAML and dictionary access in Python will cause runtime errors or missing descriptions.\n- **Using metadata in service registration**: Frameworks like Home Assistant allow `hass.services.register` (or equivalent service registration functions) to take a description/metadata object. Passing the structured description enables richer UIs and better discoverability of services.\n- **Field-level documentation**: For each service field, it is valuable to document purpose, optionality, accepted formats (e.g., templates), and provide a concrete example. This reduces user confusion and improves configuration accuracy.\n\nMore generally, this is a best practice for any extensible automation or integration platform: store human-readable service documentation in a machine-readable, centralized format and connect it to the runtime registration mechanism so both code and documentation stay in sync.",
        "procedural_memory": [
            "To diagnose and implement service descriptions similar to this fix, follow these steps:",
            "Step 1: Identify missing or inadequate service documentation\n- Check the platform's service registry UI or API (e.g., Home Assistant's Developer Tools → Services).\n- Look for services that lack descriptions, field metadata, or examples.\n- Confirm whether the framework supports external service metadata (e.g., a `services.yaml` or similar file).",
            "Step 2: Locate where the service is registered in code\n- Search the codebase for `hass.services.register` (or the framework’s equivalent service registration function) for the relevant domain.\n- Identify the domain and service name constants (e.g., `DOMAIN = 'persistent_notification'`, `SERVICE_CREATE = 'create'`).",
            "Step 3: Define the service metadata in YAML (or the configured metadata format)\n- Create or update the appropriate metadata file (e.g., `homeassistant/components/services.yaml`).\n- Follow the framework’s expected structure. For Home Assistant, the pattern is:\n  - Top-level key: the domain name (`persistent_notification:`).\n  - Nested key: the service name (`create:`).\n  - Under the service: `description:` and `fields:`.\n  - For each field under `fields:`:\n    - Add `description:` explaining the purpose and any nuances (e.g., optional, templates accepted).\n    - Add `example:` showing a typical value.\n- Ensure the YAML indentation and nesting exactly match the desired dictionary structure.",
            "Step 4: Load the metadata in the component and pass it to service registration\n- Import any necessary utilities to load the YAML, such as:\n  - `import os`\n  - `from homeassistant.config import load_yaml_config_file`\n- Load the YAML file in the setup function:\n  - `descriptions = load_yaml_config_file(os.path.join(os.path.dirname(__file__), 'services.yaml'))`\n- When calling `hass.services.register`, pass the correct description object:\n  - `hass.services.register(DOMAIN, SERVICE_CREATE, handler, descriptions[DOMAIN][SERVICE_CREATE], schema)`\n- Be precise with indices: if the YAML nests services under the domain, access `descriptions[DOMAIN][SERVICE_NAME]` rather than just `descriptions.get(DOMAIN)`.",
            "Step 5: Ensure schema and documentation are consistent\n- If the service uses a validation schema (e.g., `vol.Schema`), verify that the YAML `fields` correspond one-to-one with schema keys.\n- Align optional vs required status and accepted types (e.g., allow templates where supported).",
            "Step 6: Run tests and manual verification\n- Run the project’s test suite (e.g., `tox`) to ensure no regressions.\n- Manually reload or restart the system and inspect the service in the UI.\n- Confirm that the service now shows the description and per-field help text and examples as expected.",
            "Step 7: Adjust for future changes\n- If you later rename services or domains, update both the YAML structure and the code’s dictionary access (e.g., change `descriptions[OLD_DOMAIN][OLD_SERVICE]` accordingly).\n- Treat the YAML as a single source of truth for user-facing documentation to keep code and docs synchronized."
        ]
    }
}