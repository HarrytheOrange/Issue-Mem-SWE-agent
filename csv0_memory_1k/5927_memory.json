{
    "search_index": {
        "description_for_embedding": "Home Assistant QNAP sensor could not connect to QNAP NAS using the default self-signed HTTPS certificate because SSL verification was always enforced. The fix adds a configurable verify_ssl flag to the QNAP sensor platform schema, passes it through to the qnapstats library, and bumps the qnapstats requirement to a version that supports this parameter. Users can now set ssl: true, verify_ssl: false, port: 443 to use the NAS' default self-signed cert.",
        "keywords": [
            "Home Assistant",
            "QNAP sensor",
            "self-signed certificate",
            "SSL verification",
            "verify_ssl",
            "HTTPS port 443",
            "qnapstats",
            "REQUIREMENTS version bump",
            "config schema",
            "CONF_VERIFY_SSL",
            "integration with external library",
            "TLS connection failure"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this incident, the Home Assistant QNAP sensor integration had trouble connecting to QNAP NAS devices when they used the default self-signed HTTPS certificate. The component supported an `ssl` configuration option to switch from HTTP to HTTPS, but it always enforced SSL certificate verification with no way to override it. QNAP devices commonly ship with self-signed certs, so connections would fail when `ssl: true` and `port: 443` were used.\n\nThe developer added a new configuration option `verify_ssl` to the QNAP sensor platform schema using `CONF_VERIFY_SSL`, defaulting to `True` for safety. This new option is exposed in the YAML config and passed through to the underlying `qnapstats` library by modifying the client initialization to include `verify_ssl=config.get(CONF_VERIFY_SSL)`. To support this new parameter, the integration's `REQUIREMENTS` was updated from `qnapstats==0.2.1` to `qnapstats>=0.2.2`, which is the first version that supports the `verify_ssl` parameter. Additionally, some minor lint issues were fixed (line length and trailing whitespace) to satisfy project style guidelines.\n\nWith these changes, users can connect to QNAP devices using their default self-signed certificate by setting:\n\n- `ssl: true`\n- `verify_ssl: false`\n- `port: 443`\n\nThis allows Home Assistant to communicate over HTTPS with self-signed certificate QNAP NAS devices while preserving secure defaults for other setups.",
        "semantic_memory": "This fix illustrates a common pattern when integrating with devices or services that use self-signed TLS/SSL certificates. By default, integrations should validate certificates (`verify_ssl = True`) for security. However, in many home network or embedded device scenarios, self-signed certificates are the norm, and strict verification will cause connection failures.\n\nA good design pattern is:\n- Expose a `verify_ssl` configuration option (or similarly named flag) to allow advanced users to override SSL verification.\n- Default this flag to `True` for secure-by-default behavior.\n- Propagate this option down to any underlying HTTP or API client library that performs the TLS handshake.\n- Ensure the dependency version is bumped to one that actually supports the new parameter to avoid runtime errors.\n\nThis case also highlights the importance of:\n- Keeping platform schemas and configuration validation in sync with external library capabilities.\n- Updating `REQUIREMENTS` when you rely on new features from third-party packages.\n- Handling style and lint issues (line length, trailing whitespace) as part of the same PR for smooth CI.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Identify the failure mode\n- Observe connection failures when enabling SSL/TLS to an external device or service (e.g., setting ssl: true, port: 443).\n- Check logs for SSL-related errors (certificate verify failed, self-signed certificate, etc.).\n- Confirm whether the target device is using a self-signed certificate or a certificate not trusted by the system CA store.",
            "Step 2: Inspect existing configuration and integration code\n- Review the integration's configuration schema (e.g., Home Assistant PLATFORM_SCHEMA) to see if there is a `verify_ssl` or similar option.\n- Examine where the client for the external service is created and whether any SSL options (verify, cert, etc.) are passed through.",
            "Step 3: Check the underlying library capabilities\n- Locate the external library used to talk to the device (here, `qnapstats`).\n- Check its documentation or source for support of SSL-related parameters (e.g., `verify_ssl`, `verify`, `cert`).\n- Determine from which version this parameter is available.",
            "Step 4: Extend the integration configuration schema\n- Add a new optional configuration parameter (e.g., `CONF_VERIFY_SSL`) to the platform schema.\n- Set a secure default, typically `True` for `verify_ssl`.\n- Ensure the constant is imported from the shared constants module if the framework provides one.",
            "Step 5: Pass the configuration to the client constructor\n- Modify the integration where it instantiates the API client to include the new parameter, e.g.:\n  - Before: `Client(base_url, port, username, password)`\n  - After: `Client(base_url, port, username, password, verify_ssl=config.get(CONF_VERIFY_SSL))`\n- Verify that parameter names and types match the underlying library signature.",
            "Step 6: Update dependency constraints\n- In the integration file, update the `REQUIREMENTS` or equivalent dependency specification to a version that supports the new parameter (e.g., from `qnapstats==0.2.1` to `qnapstats>=0.2.2`).\n- Avoid pinning to an older version that lacks required features.",
            "Step 7: Adjust documentation and examples\n- Update user-facing documentation to describe the new option, its default, and example usage.\n- Provide a concrete configuration snippet for common scenarios (e.g., `ssl: true`, `verify_ssl: false`, `port: 443` for QNAP with self-signed cert).",
            "Step 8: Run tests and linting\n- Run unit tests or integration tests to ensure no regressions.\n- Fix any style/lint issues (line length, trailing whitespace, etc.) flagged by CI.",
            "Step 9: Validate behavior in a real environment\n- Configure the integration with `verify_ssl: false` against a device using a self-signed certificate and confirm successful connection.\n- Optionally test with a valid CA-signed certificate and `verify_ssl: true` to ensure secure behavior remains intact."
        ]
    }
}