{
    "search_index": {
        "description_for_embedding": "StackStorm workflows were failing or behaving inconsistently because the coordinator backend (tooz) was not reliably configured or available by default. The fix makes Redis the default coordinator backend, adds the redis Python client as a dependency, and sets a default Redis URL in the development configuration to avoid coordinator-related workflow issues.",
        "keywords": [
            "StackStorm",
            "workflow coordinator",
            "tooz",
            "redis backend",
            "default coordinator backend",
            "redis==3.5.3",
            "st2common",
            "configuration",
            "dependency management",
            "workflow issues"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this incident, StackStorm workflows were susceptible to failures and subtle issues because the coordinator service (used by tooz for distributed coordination) was not properly configured by default, especially in new or development installations. Users often didn't have a coordinator backend set up or the necessary backend dependencies installed, leading to workflow problems that were hard to diagnose. To address this, the PR made Redis the default coordinator backend. It updated the development configuration file `conf/st2.dev.conf` to set `url = redis://127.0.0.1:6379` for the coordinator, ensuring that a local Redis instance is used by default. The PR also added the `redis` Python package as a concrete dependency in `requirements.txt`, `fixed-requirements.txt`, and `st2common/requirements.txt`, and added `redis` to `st2common/in-requirements.txt` with a comment clarifying it as the default coordinator backend for tooz. The CHANGELOG was updated to document this behavior change. Together with a paired change in packaging, this ensures that Redis server and its Python client are installed and configured by default, significantly reducing coordinator-related workflow issues for new StackStorm users.",
        "semantic_memory": "Distributed workflow systems often require a coordination backend (for locks, leader election, and distributed state). If that backend is optional or poorly defaulted, new users can experience confusing intermittent failures or non-deterministic behavior. A robust default should both (1) explicitly configure a working backend (e.g., Redis) and (2) declare all required client libraries as hard dependencies, rather than relying on users to install them manually or on transitive/optional dependencies. For libraries like tooz that support pluggable backends, the application must ensure that the chosen backend is both installed and referenced in configuration. Providing a concrete default URL (e.g., `redis://127.0.0.1:6379`) in development or out-of-the-box configs dramatically reduces onboarding friction and misconfiguration. Documentation and packaging (e.g., OS packages, docker images, vagrant setups) should be updated together with code so that the runtime environment actually provides the services the configuration assumes.",
        "procedural_memory": [
            "Diagnosing missing or misconfigured coordination backends in workflow systems:",
            "Step 1: Observe symptoms. Look for workflow tasks that hang, fail intermittently, or show errors related to locks, coordination, or tooz (or similar coordination libraries). Check logs for messages indicating missing coordinator URLs, connection failures, or unsupported backend drivers.",
            "Step 2: Inspect configuration. Locate the service configuration related to coordination (for StackStorm, the coordinator section, e.g., in `st2.conf` or `st2.dev.conf`) and verify that a specific backend URL is configured (e.g., `redis://127.0.0.1:6379` or another supported tooz backend). If the URL is commented out or missing, that is likely the cause.",
            "Step 3: Verify backend availability. If a backend like Redis is configured, ensure the server is installed and running on the target host and port. Use tools like `redis-cli ping` or `telnet host port` to verify connectivity.",
            "Step 4: Check Python dependencies. Confirm that the Python client library for the chosen backend is installed in the application environment. For Redis, ensure `redis` is pinned and present in your `requirements.txt` / `setup.py` and actually installed in the runtime virtualenv or container. For tooz, remember that individual backend dependencies often must be installed explicitly.",
            "Step 5: Make a safe default. If most users need a coordinator by default, choose a widely supported backend (e.g., Redis) and make it the default in configuration, including a concrete URL. Update sample/dev config files to include this default so that new environments work out of the box.",
            "Step 6: Declare hard dependencies. Add the relevant backend client library (e.g., `redis==<version>`) to all requirements files that govern the runtime (e.g., `requirements.txt`, `fixed-requirements.txt`, component-specific requirements such as `st2common/requirements.txt` and `in-requirements.txt`). Avoid relying on optional extras or implicit transitive dependencies when the backend is required for core functionality.",
            "Step 7: Align packaging and infrastructure. Ensure OS packages, Docker images, and Vagrant/dev environments install and start the backend service (e.g., `redis-server`) so that the configured default URL is actually reachable.",
            "Step 8: Update documentation and changelog. Document the new default backend and any operational implications (e.g., a Redis service is now required by default). Note the change in CHANGELOG or release notes so operators understand that Redis will be used unless they configure another backend.",
            "Step 9: Test end-to-end. After changes, run representative workflows to confirm coordination-related operations (locks, task scheduling, distributed state) function reliably and that new installations no longer exhibit the original failures."
        ]
    }
}