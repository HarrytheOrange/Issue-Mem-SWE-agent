{
    "search_index": {
        "description_for_embedding": "Packaging fix: Cython was incorrectly listed as a mandatory install dependency (install_requires) even though Optuna does not require it at runtime. This caused unnecessary installation of Cython, especially for Python 3.9+, where it was only needed to build some optional dependencies (e.g., scikit-learn when no wheel is available). The fix removes Cython from install_requires and instead adds it to specific extras_require groups (optional, doctest, example) with a python_version > '3.8' condition.",
        "keywords": [
            "Cython",
            "install_requires",
            "extras_require",
            "setup.py",
            "optional dependency",
            "Python 3.9",
            "wheels",
            "packaging",
            "dependency management",
            "scikit-learn",
            "test extras",
            "doctest",
            "example dependencies"
        ]
    },
    "agent_memory": {
        "episodic_memory": "The project had Cython listed in install_requires for Python versions > 3.8, based on a note that some libraries in the dependency tree required Cython to build from source. However, Cython is not actually a runtime dependency of the project itself; it is only needed in some environments to build specific optional packages (e.g., scikit-learn when a wheel is unavailable for Python 3.9). This made Cython an unnecessary hard requirement for all users installing the library on those Python versions.\n\nThe pull request refactored setup.py as follows:\n- Removed the conditional Cython dependency from get_install_requires, so the core package no longer depends on Cython.\n- Adjusted extras_require to attach Cython only to optional feature groups and documentation/test-related groups, and only for Python versions > 3.8:\n  - Added Cython (with python_version > '3.8') to the 'doctest' extra alongside cma and visualization libs.\n  - Added Cython (with python_version > '3.8') to the 'example' extra alongside catboost, chainer, lightgbm, mlflow, etc.\n  - Moved the Cython requirement out of 'tests' (so basic tests no longer force Cython) and into the 'optional' and some other extras where it’s actually needed.\n  - Re-introduced Cython with python_version > '3.8' into 'optional' and some related extras in a more consistent way, together with TODO comments making it clear that Cython should be removed once sklearn version constraints no longer require it.\n\nAdditionally, the CI documentation jobs were intermittently failing due to an unrelated HTTP 503 error in a multi-objective tutorial example that fetched data over the network. This was noted in the PR discussion but not directly addressed by the code changes. The essential fix of this PR is to cleanly separate Cython as an optional, conditional dependency rather than a mandatory install-time dependency.",
        "semantic_memory": "This fix illustrates a common packaging best practice: only declare true runtime dependencies in install_requires, and move build-time or optional-only tools to extras_require or to environment-specific conditional dependencies.\n\nCython, compilers, and similar tools are often needed only to build certain optional packages (e.g., scikit-learn when no wheel is available), not for the core library to function. Making them mandatory in install_requires can:\n- Increase installation friction (users need compilers/build tools, longer install time).\n- Pollute environments with unnecessary packages.\n- Cause seemingly unrelated installation failures on platforms where building from source is problematic.\n\nInstead, you should:\n- Keep install_requires minimal and limited to what is strictly needed at runtime.\n- Use extras_require groups (e.g., 'optional', 'docs', 'tests', 'examples') to declare dependencies for optional features, documentation builds, test suites, and example scripts.\n- Use environment markers (e.g., \"Cython; python_version > '3.8'\") to scope dependencies to specific Python versions or platforms where they are actually required.\n- Add TODO comments and clear rationale when including such conditional dependencies, so they can be removed once upstream packages provide wheels or relax constraints.\n\nThe case also highlights that CI failures (like HTTP 503 from external services used in docs/examples) may be orthogonal to dependency management issues; these should be considered separately when interpreting PR outcomes.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Confirm whether a dependency is truly required at runtime.\n- Inspect your codebase and determine if the package (e.g., Cython) is imported or used directly by the library at runtime.\n- If it is only needed to build other packages (e.g., scikit-learn) or for examples/tests/docs, it should not be in install_requires.",
            "Step 2: Identify where the dependency is currently declared.\n- Check setup.py (or pyproject.toml/setup.cfg) for the dependency in install_requires or equivalents.\n- Look for version-conditional logic (e.g., using sys.version_info or environment markers) that may add it implicitly.",
            "Step 3: Move non-essential dependencies to extras_require.\n- Create or update extras_require groups such as 'optional', 'tests', 'docs', 'examples', or more fine-grained feature extras (e.g., 'sklearn').\n- Place the package (e.g., Cython) in the appropriate extras where it is genuinely needed (e.g., 'optional', 'docs', 'example').",
            "Step 4: Use environment markers for conditional dependencies.\n- If the dependency is only required for certain Python versions or platforms, attach it with an environment marker, e.g.: \"Cython; python_version > '3.8'\".\n- This ensures users on unaffected environments do not get unnecessary packages.",
            "Step 5: Update tests and CI to use the new extras.\n- In CI configuration, install the project with the appropriate extras for the job type (e.g., `pip install .[tests]` or `pip install .[docs]`).\n- Ensure any jobs that rely on optional dependencies explicitly install the extras that include them.",
            "Step 6: Document the rationale and add TODOs.\n- Add comments explaining why such optional/conditional dependencies exist (e.g., required until scikit-learn provides wheels for Python 3.9).\n- Include TODO notes to remove these dependencies once upstream issues are resolved so they don’t become permanent clutter.",
            "Step 7: Re-run CI and verify behavior.\n- Run installation and tests in clean environments to confirm that users can install the core package without the extra dependency.\n- Check that doc builds, examples, and optional feature tests still work when installed with the appropriate extras.\n- Treat unrelated CI errors (e.g., external HTTP 503s in examples) separately from dependency-management fixes."
        ]
    }
}