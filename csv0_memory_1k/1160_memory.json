{
    "search_index": {
        "description_for_embedding": "CI configuration change for napari: the pip-check-reqs requirements check was renamed and merged into the coverage (codecov) Cirrus CI task, auto_cancellation was enabled, and pip-check-reqs is now installed from a specific GitHub PR to avoid requiring an old pip version. The test_script was renamed to check_requirements_script to better reflect its purpose and align with other CI phases.",
        "keywords": [
            "Cirrus CI",
            "requirements check",
            "pip-check-reqs",
            "pip-missing-reqs",
            "GitHub checks UI",
            "auto_cancellation",
            "coverage_task",
            "codecov_task",
            "CI configuration",
            "requirements_task",
            "pip<19.3",
            "custom *_script names"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this PR, the project’s Cirrus CI configuration was adjusted around a requirements verification job. Initially, there was a dedicated `requirements_task` in `.cirrus.yml` with a `test_script` that ran `pip-missing-reqs` using `pip-check-reqs`, and it forced an older pip (`pip<19.3`) because the published `pip-check-reqs` package was incompatible with newer pip versions. This separate task appeared as an additional check in GitHub, and maintainers noticed odd behavior in how GitHub rendered the list of checks (e.g. seeing a collapsed or unexpected view of test statuses). They first renamed the task (to `Check Requirements`) and added `auto_cancellation: true` so redundant runs would be canceled on new pushes. However, there was still discomfort with an extra, relatively slow, stand-alone CI task and the brittle dependency on an old pip.\n\nTo improve this, the maintainer merged the requirements check into the existing `codecov_task`. The `requirements_task` block was removed. The `codecov_task` was renamed to `Coverage & Requirements` and marked with `auto_cancellation: true`. In its `install_script`, they now install `pip-check-reqs` not from PyPI but from a specific GitHub PR (`git+https://github.com/r1chardj0n3s/pip-check-reqs.git@refs/pull/22/head`), which contains fixes for newer pip, then install development requirements, the package in editable mode, and coverage tools (pytest-cov, codecov). The requirements check (`pip-missing-reqs napari ...`) was added as a separate script phase within this task, but renamed from `test_script` to `check_requirements_script` for clarity and consistency with other phases. Coverage is then run in `coverage_script` as before. This restructuring keeps the requirements verification, avoids having to downgrade pip, consolidates checks into a later, slower task, and reduces the number of separate GitHub CI checks shown in the UI.",
        "semantic_memory": "General lessons from this change:\n\n1. **Merge slow or secondary validations into later CI stages**: Slow checks that aren’t necessary to fail fast (like verifying requirements coverage) can be merged into later tasks (e.g. coverage) instead of being separate, early tasks. This keeps the CI check list shorter and focuses early feedback on critical tests.\n\n2. **Be careful with tooling that lags behind dependency ecosystems**: Tools like `pip-check-reqs` may not keep up with newer pip versions. Forcing the entire CI to use an old pip can introduce brittle constraints. A targeted workaround (e.g. installing a patched version from a specific GitHub PR) may be more maintainable, but should be clearly documented.\n\n3. **Use CI task naming and script phases for clarity and UX**: Naming tasks (`name: Coverage & Requirements`) and script phases (`check_requirements_script` vs `test_script`) improves developer understanding and can influence how CI systems and GitHub display results. Aligning naming conventions across tasks (lint, tests, coverage, requirements) keeps CI dashboards more readable.\n\n4. **Use auto-cancellation for PR-driven CI**: Enabling `auto_cancellation: true` on CI tasks that are likely to become obsolete when a new commit is pushed saves resources and reduces noise in CI status reporting.\n\n5. **Document non-standard dependency sources**: When installing from a GitHub PR or non-PyPI source, it’s important to leave comments explaining why (e.g. compatibility with newer pip, pending upstream fix) so future maintainers understand and can revisit once upstream is updated.",
        "procedural_memory": [
            "When a CI requirements check is causing friction or brittleness (e.g., requiring an old pip, generating extra checks, or confusing UI), consolidate and modernize it.",
            "Step 1: Identify the existing CI task running requirements verification (e.g., a `requirements_task` or a `test_script` invoking pip-missing-reqs or similar). Note its dependencies (pip version, tools like pip-check-reqs) and how it appears in GitHub checks.",
            "Step 2: Decide where this check logically belongs in your pipeline. For a requirements coverage check, a good target is an existing coverage or integration test task that already installs the full development environment.",
            "Step 3: Remove the standalone requirements task from the CI configuration (e.g., delete the `requirements_task` block in `.cirrus.yml`) to reduce the number of separate CI checks shown in GitHub.",
            "Step 4: Update the chosen target task (e.g., `codecov_task`) to incorporate the requirements check:\n- Give the task a descriptive name that reflects its combined responsibilities, such as `Coverage & Requirements`.\n- Ensure `auto_cancellation: true` is set, especially for PR-driven tasks, to cancel outdated runs when new commits are pushed.",
            "Step 5: Fix compatibility issues with the requirements-checking tool:\n- If the tool requires an older pip, evaluate whether pinning pip is acceptable.\n- If not, look for a maintained fork or a PR that adds support for newer pip.\n- Install that version explicitly in the CI `install_script`, e.g. `pip install git+https://...@refs/pull/XYZ/head`.\n- Add comments to the CI config explaining why this non-standard source is used.",
            "Step 6: In the new combined task, add a dedicated script phase for the requirements check rather than reusing `test_script` if it’s not a typical unit test. For Cirrus CI, you can add a custom phase like `check_requirements_script:` with the `pip-missing-reqs` command and any ignore flags needed (e.g., to skip tests or known false positives).",
            "Step 7: Keep the coverage command in a separate script phase (e.g., `coverage_script:`) so both checks (requirements and coverage) are run in the same task but remain logically distinct in the CI logs.",
            "Step 8: Push the CI configuration changes and verify:\n- All checks still run successfully (requirements check and coverage).\n- The GitHub checks UI now shows a simpler, more understandable set of CI checks.\n- No old pip version pinning remains unless explicitly desired.",
            "Step 9: Periodically revisit the non-standard dependency (e.g., the specific GitHub PR for pip-check-reqs). If the upstream project releases a compatible version, switch back to the official package and remove the Git reference and explanatory comments."
        ]
    }
}