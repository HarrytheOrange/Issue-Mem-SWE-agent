{
    "search_index": {
        "description_for_embedding": "Refactor Home Assistant NZB sensors (e.g., sabnzbd) to use voluptuous for configuration validation and align configuration schema with other sensors. Introduces host/port configuration, removes deprecated 'type' key, and establishes default ports. This is a breaking change to the YAML configuration format.",
        "keywords": [
            "Home Assistant",
            "NZB sensors",
            "sabnzbd",
            "nzbget",
            "voluptuous",
            "configuration validation",
            "YAML schema change",
            "breaking change",
            "host and port configuration",
            "sensor platform migration"
        ]
    },
    "agent_memory": {
        "episodic_memory": "This pull request updated Home Assistant's NZB-related sensors (such as the sabnzbd sensor) to use the voluptuous library for configuration validation instead of the older, less structured approach. As part of the migration, the configuration schema for these sensors was changed to align with the conventions used by other Home Assistant sensors. Specifically, configuration now uses separate `host` and `port` fields instead of relying on implicit/default behavior or older keys, and the `- type:` key in the YAML configuration was removed. The PR also updated the corresponding `const.py` definitions and ensured that dependencies and coverage settings were correctly adjusted (`requirements_all.py`, `.coveragerc`, and local tox tests). This introduced a breaking change for users, requiring them to update their `configuration.yaml` entries, for example:\n\nsensor:\n  - platform: sabnzbd\n    api_key: !secret sabnzb_api\n    host: 10.100.0.111\n    monitored_variables:\n      - 'current_status'\n      - 'speed'\n      - 'queue_size'\n      - 'queue_remaining'\n      - 'disk_size'\n      - 'disk_free'\n\nThe maintainers decided to stage this for the 0.27 release (after 0.26) to allow time for user feedback and testing, given that multiple sensors were being gradually migrated to voluptuous. The main value of the PR was improved validation, consistent configuration patterns across sensors, and clearer, more explicit configuration options at the cost of a backward-incompatible config change.",
        "semantic_memory": "Using voluptuous (or similar schema libraries) for configuration validation in integrations like Home Assistant sensors leads to more robust, predictable behavior and easier maintenance. When migrating to a schema-based validation system, it is an opportunity to normalize configuration options across related components (e.g., always using `host` and `port` keys, establishing sensible defaults, and removing legacy or ambiguous keys like generic `type`). Such migrations often create breaking changes for users; therefore, they must be coordinated with documentation updates, version planning, and clear migration examples.\n\nGeneral best practices include:\n- Align configuration schemas across similar components (e.g., sensors, platforms) to reduce user confusion and code duplication.\n- Introduce explicit keys for connection details (`host`, `port`) and leverage default ports where appropriate, rather than relying on implicit behavior.\n- Use validation libraries (like voluptuous) to catch configuration errors early and provide helpful error messages.\n- Treat configuration schema changes as breaking changes, schedule them for major/minor releases, and communicate migration paths clearly.\n- Group migrations into manageable, small PRs per component or per small set of components, to limit the blast radius if an issue is found and to simplify review.\n- Ensure that new dependencies are added in a central requirements list, only imported where needed, and covered by tests and coverage configuration.",
        "procedural_memory": [
            "When migrating a Home Assistant sensor (or similar integration) to voluptuous or another schema validation library, follow these steps:",
            "Step 1: Analyze the current configuration format and behavior.\n- Identify all existing configuration keys used by the platform/sensor (e.g., `host`, `port`, `api_key`, `type`, etc.).\n- Note which fields are required, which have defaults, and any implicit behaviors (like assumed ports or default hosts).",
            "Step 2: Design a consistent configuration schema.\n- Align with existing conventions in the ecosystem (e.g., for Home Assistant sensors, prefer `host`, `port`, `api_key`, `monitored_variables`).\n- Remove or deprecate ambiguous or redundant keys (e.g., remove `type` if it conflicts with platform conventions).\n- Decide on sensible default values (e.g., default port for a given daemon).",
            "Step 3: Implement the voluptuous schema.\n- Define a `PLATFORM_SCHEMA` or equivalent schema using voluptuous (e.g., `vol.Schema`, `vol.Required`, `vol.Optional`, `cv.string`, `cv.port`).\n- Encode the default values in the schema, rather than in ad hoc runtime checks.\n- Validate any list fields (like `monitored_variables`) with explicit allowed values if appropriate.",
            "Step 4: Refactor the platform setup to use the schema.\n- Replace manual config parsing with the validated config object returned by the schema.\n- Update the platform setup code to read from `config[CONF_HOST]`, `config[CONF_PORT]`, etc.\n- Remove legacy handling for deprecated keys (`type`, old structures) if you are intentionally breaking compatibility.",
            "Step 5: Update constants and shared definitions.\n- Add or adjust constants (e.g., `CONF_HOST`, `CONF_PORT`, `DEFAULT_PORT`) in `const.py` or the shared constants module.\n- Ensure that the platform imports these constants instead of hardcoding strings or numbers.",
            "Step 6: Handle dependencies and coverage.\n- Add any new third-party dependencies to the component’s `REQUIREMENTS` and to `requirements_all.txt` using the project’s tooling (e.g., `script/gen_requirements_all.py`).\n- Ensure imports of new dependencies are localized to the functions that use them to avoid unnecessary import overhead.\n- Add new files or modules to `.coveragerc` if required by the project's policies.",
            "Step 7: Update documentation and configuration examples.\n- Provide updated YAML examples reflecting the new schema (e.g., showing `host` and `port` instead of older keys, and without `- type:` if it was removed).\n- Clearly label the change as breaking and show a before/after configuration snippet.",
            "Step 8: Plan the release and communicate breaking changes.\n- Target a minor or major release known for schema changes (e.g., 0.27 instead of 0.26).\n- Mention the breaking change in release notes and link to updated docs and migration instructions.\n- Encourage users to test the new configuration and provide feedback.",
            "Step 9: Test thoroughly.\n- Run local tests (e.g., `tox`) to ensure no regressions.\n- Add or update unit tests to cover configuration validation, including invalid configs and edge cases.\n- If possible, manually test against actual services (e.g., sabnzbd) with typical configurations.",
            "Step 10: Prefer small, focused PRs.\n- If multiple sensors or integrations are being migrated, group them into small, separate PRs.\n- This isolates potential issues and makes it easier to revert or adjust one platform without blocking others."
        ]
    }
}