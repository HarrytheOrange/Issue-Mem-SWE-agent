{
    "search_index": {
        "description_for_embedding": "Home Assistant alpha_vantage sensor removed undocumented default symbols/currency configuration. Previously, if users did not configure symbols or foreign_exchange, the integration silently created default Google stock and BTC-USD sensors. This behavior was removed; now the platform requires explicit configuration and shows a persistent notification and log warning when no symbols or currencies are defined. Also fixed a typo in the TRY currency icon name.",
        "keywords": [
            "home assistant",
            "alpha_vantage",
            "sensor.alpha_vantage",
            "default configuration removed",
            "undocumented defaults",
            "breaking change",
            "persistent_notification",
            "no symbols configured",
            "no currencies configured",
            "foreign_exchange",
            "schema defaults",
            "mdi:currency-try typo",
            "icon mapping bug",
            "configuration validation"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this incident, the Home Assistant alpha_vantage sensor component had an undocumented behavior: when users added the alpha_vantage sensor with only an API key and no explicit symbols or foreign_exchange pairs, the platform automatically created default sensors (a Google stock symbol and a BTC-to-USD currency conversion). These defaults were not described in the official documentation, leading users to see them as unexpected or buggy behavior.\n\nThe core change removed these implicit defaults. In the platform schema, the `foreign_exchange` and `symbols` options previously had default values (`DEFAULT_CURRENCY` and `DEFAULT_SYMBOL`) that were injected even when the user defined nothing. The patch deletes the `DEFAULT_SYMBOL` and `DEFAULT_CURRENCY` dictionaries and removes them as `default=` values from the `PLATFORM_SCHEMA` extensions. Now both `CONF_SYMBOLS` and `CONF_FOREIGN_EXCHANGE` are optional without defaults.\n\nIn `setup_platform`, the code was updated to explicitly check whether the user configured any symbols or foreign exchanges. It now retrieves `symbols = config.get(CONF_SYMBOLS)` and `conversions = config.get(CONF_FOREIGN_EXCHANGE)` and then evaluates `if not symbols and not conversions:`. If both are empty or missing, the integration no longer creates any sensors; instead it issues a `persistent_notification` with the message 'Warning: No symbols or currencies configured.' and logs a warning via `_LOGGER.warning(msg)`, then returns early.\n\nAdditionally, a bug in the currency icon map was fixed. The icon for the Turkish Lira (`TRY`) was incorrectly defined as `'mdi: currency-try'` with an extra space, preventing the correct icon from rendering. The patch corrects this to `'mdi:currency-try'`. A minor refactor simplified the condition from an explicit `symbols is None or len(symbols) == 0` pattern to the more Pythonic `if not symbols and not conversions:`. Documentation was updated in a separate PR to mark this as a breaking change and clarify that users must now define either `symbols:` or `foreign_exchange:` entries to get data.",
        "semantic_memory": "This fix illustrates several generalizable practices in configuration-driven integrations:\n\n1. **Avoid undocumented implicit defaults:** Automatically creating resources (e.g., default sensors, default symbols) that are not clearly documented can surprise users and be perceived as bugs. Defaults should be either explicit in the docs or omitted if they are not universally useful.\n\n2. **Make configuration requirements explicit:** If a component needs at least one of several configuration options (e.g., symbols or currency pairs), validate this early in setup and give the user clear feedback. Returning early with a user-visible message (and log entry) is preferable to silently misconfiguring or creating unwanted defaults.\n\n3. **Use platform-appropriate feedback channels:** In Home Assistant, `persistent_notification` is an effective pattern for notifying users about misconfiguration right in the UI. Pairing this with `_LOGGER.warning` ensures traceability in logs.\n\n4. **Be careful with schema defaults:** In systems that use configuration schemas (e.g., voluptuous), `default=` values can inject configuration even when users specify nothing. This may mask errors or create surprising behavior. For optional features, consider omitting defaults and letting `None` or empty lists signal \"not configured\".\n\n5. **Simplify truthiness checks:** Instead of verbose checks like `if symbols is None or len(symbols) == 0`, use Python’s truthiness (`if not symbols`) to make code clearer and less error-prone, especially when the value can be `None` or a sequence.\n\n6. **Validate static mappings (like icon names):** Small typos in string constants for icons or keys can cause subtle UI issues. Keeping such mappings small, reviewed, and ideally covered by tests (or linters that know valid icon names) avoids these bugs.\n\n7. **Breaking changes from removing defaults:** Removing a default, even an undocumented one, can be a breaking change if users relied on sample configurations. Such changes should be explicitly called out in release notes and documentation, and ideally accompanied by migration guidance.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Identify unexpected defaults or behavior\n- Review user reports for complaints about unexpected entities, sensors, or resources appearing without being configured.\n- Compare the documented behavior of the integration with the actual runtime behavior. Look especially at code paths that provide default configuration values.",
            "Step 2: Inspect the configuration schema\n- Locate the schema definition (e.g., Home Assistant PLATFORM_SCHEMA, voluptuous schemas).\n- Check for `default=` values on optional configuration fields that might be injecting behavior even when the user does not specify those fields.\n- Look for hard-coded default dictionaries or lists (like DEFAULT_SYMBOL or DEFAULT_CURRENCY) that are used in these defaults.",
            "Step 3: Decide on intended behavior and update documentation\n- Determine whether the default behavior is desired and should be documented, or whether it should be removed.\n- If keeping defaults, update documentation to describe them and why they exist.\n- If removing defaults, plan this as a potential breaking change and ensure release notes/documentation are updated accordingly.",
            "Step 4: Remove or adjust problematic defaults in the schema\n- Delete or modify `default=` arguments in configuration schemas so that optional fields are truly optional and absent when not configured.\n- Remove or refactor any global DEFAULT_* structures that were only used to provide these implicit values.\n- Ensure that the resulting configuration can produce `None` or empty lists for non-configured options.",
            "Step 5: Add explicit runtime validation and user feedback\n- In the setup or initialization function, read the relevant configuration fields.\n- Implement a clear condition that checks whether required configuration is present (e.g., `if not symbols and not conversions:`).\n- If the configuration is insufficient, log a warning and present a user-facing notification using the platform’s standard mechanism (e.g., `persistent_notification.create` in Home Assistant), then return early without creating any entities.",
            "Step 6: Clean up and simplify logic\n- Replace verbose checks like `if x is None or len(x) == 0` with more idiomatic `if not x` where appropriate.\n- Ensure that the logic correctly handles `None`, empty lists, and other falsy values.",
            "Step 7: Validate static data like icon mappings or constants\n- Review static dictionaries and constants for typos, such as icon names (`mdi:currency-try` vs `mdi: currency-try`).\n- If possible, add tests or assertions to verify that commonly used identifiers (icons, keys) match expected patterns.",
            "Step 8: Test with multiple configuration scenarios\n- Test with no `symbols` and no `foreign_exchange` configured: verify that no sensors are created, a persistent notification appears, and a warning is logged.\n- Test with only `symbols` configured and only `foreign_exchange` configured: verify that the correct sensors are created and no warnings are emitted.\n- Test with both configured together: verify all sensors appear and behave correctly.",
            "Step 9: Communicate the breaking change\n- Mark the removal of implicit defaults as a breaking change in release notes.\n- Provide migration guidance: tell users that they must define at least one symbol or foreign_exchange entry for the alpha_vantage sensor to produce data.",
            "Step 10: Monitor and iterate\n- After release, monitor user reports for confusion or misconfigurations.\n- If many users are affected, consider adding more explicit error messages, examples in documentation, or configuration validation tips."
        ]
    }
}