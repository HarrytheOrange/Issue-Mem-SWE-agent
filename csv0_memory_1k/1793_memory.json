{
    "search_index": {
        "description_for_embedding": "Added optional support for using the system user's ~/.ssh/config file in StackStorm's Fabric-based SSH runner via a new ssh_runner.use_ssh_config config option, wired into Fabric's env.use_ssh_config, with docs and tests updated. Default behavior remains unchanged.",
        "keywords": [
            "ssh",
            "ssh_config",
            "Fabric",
            "fabric_runner",
            "ssh_runner",
            "StackStorm",
            "remote execution",
            "configuration flag",
            "env.use_ssh_config",
            "paramiko runner parity"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this change set, the Fabric-based SSH runner in StackStorm was updated to optionally honor the user's SSH config file (~/.ssh/config). Prior to the change, the runner did not use the SSH config, meaning settings like custom ports or host aliases defined there were ignored. To avoid unexpected behavior, the feature was implemented as an opt-in configuration instead of being enabled by default.\n\nThe implementation introduced a new boolean option `use_ssh_config` under the `ssh_runner` configuration group in `st2actions/st2actions/config.py`, defaulting to `False`. In the Fabric runner (`st2actions/st2actions/runners/fabric_runner.py`), this option is wired into Fabric's global environment via `env.use_ssh_config = cfg.CONF.ssh_runner.use_ssh_config`. When enabled, Fabric will leverage the local SSH config for simple settings (e.g., ports), within the limitations documented by Fabric.\n\nTo maintain consistency and keep tests passing, the same `use_ssh_config` option was registered in the test configuration (`st2tests/st2tests/config.py`). Documentation was added to `docs/source/install/config.rst` explaining how to enable this behavior by configuring `/etc/st2/st2.conf` with:\n\n[ssh_runner]\nuse_ssh_config = True\n\nThe discussion noted that this change does not alter default behavior and hinted at the expectation that similar support might be considered for the newer Paramiko-based SSH runner in the future.",
        "semantic_memory": "This change illustrates a common pattern when extending infrastructure or orchestration tools with optional features that can impact connectivity behavior. When integrating SSH clients (e.g., Fabric, Paramiko) into higher-level systems, it's often desirable to respect a user's `~/.ssh/config` for host aliases, ports, and other connection parameters. However, enabling such behavior by default can introduce surprising behavior due to implicit overrides and the library's partial or inconsistent support for all SSH config directives.\n\nA robust approach is to:\n- Surface such behavior via an explicit configuration flag (e.g., `use_ssh_config`) scoped to the relevant runner or component.\n- Default the flag to `False` to preserve backward-compatible behavior and minimize surprises in existing deployments.\n- Wire the configuration into the underlying library's appropriate setting (e.g., `env.use_ssh_config` in Fabric) rather than re-implementing the feature.\n- Mirror configuration options between production code and test configuration, so tests run with a well-defined configuration surface and do not break when new options are introduced.\n- Update documentation with a minimal, concrete example showing how to enable the feature and describing its intended, limited use (e.g., mainly for ports and simple overrides).\n\nMore broadly, this is a pattern for introducing opt-in, environment-sensitive behavior in distributed automation systems: add a config-controlled integration with the user's environment, document its limitations, and maintain consistent schema across modules and tests.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Identify the missing or desired behavior in the runner",
            "Confirm what behavior users expect from the remote execution runner (e.g., honoring ~/.ssh/config for ports, host aliases, or other settings). Check the underlying SSH library's capabilities (Fabric, Paramiko, etc.) to see if it already supports this behavior through a configuration toggle (e.g., Fabric's env.use_ssh_config).",
            "Step 2: Decide on default behavior and risk profile",
            "Evaluate whether enabling the feature by default could break existing workflows (e.g., different ports, host mappings, or unexpected host resolution). If the risk is non-trivial, plan to expose it as an opt-in configuration flag with a safe default (usually disabled).",
            "Step 3: Add a configuration option in the main config schema",
            "In the central configuration module, add a new option in the appropriate group (here, the ssh_runner group):",
            "  - Use a descriptive name (e.g., use_ssh_config).",
            "  - Choose the correct type (BoolOpt, StrOpt, etc.).",
            "  - Set a backward-compatible default (False if it's a potentially disruptive behavior).",
            "  - Provide a clear help string explaining what it does and any limitations (e.g., 'Use the .ssh/config file. Useful to override ports etc.').",
            "Step 4: Wire the config into the runner implementation",
            "Locate the runner code that initializes or configures the SSH library (e.g., Fabric's env or Paramiko's client). Set the library's corresponding parameter using the new config option. For Fabric, this means assigning:",
            "  env.use_ssh_config = cfg.CONF.ssh_runner.use_ssh_config",
            "Ensure this happens early in runner initialization so all connections use the intended setting.",
            "Step 5: Mirror the config in the test configuration",
            "Update the test configuration schemas (e.g., st2tests/st2tests/config.py) to include the same option with the same default and help text. This prevents tests from failing due to unknown configuration options and ensures test environments reflect the full configuration surface.",
            "Step 6: Add or adjust tests if needed",
            "If there are tests around runner configuration or behavior, update or add tests to verify that:",
            "  - The new option is recognized and can be set.",
            "  - The runner reads the option and passes it to the underlying SSH library.",
            "If fully end-to-end testing of ~/.ssh/config integration is difficult, at minimum test the configuration propagation (e.g., the Fabric env flag is set correctly).",
            "Step 7: Update documentation",
            "Document the new option in user-facing configuration docs:",
            "  - Explain what the option does and where it should be configured (e.g., /etc/st2/st2.conf).",
            "  - Provide a short config snippet under the correct section (e.g., [ssh_runner] use_ssh_config = True).",
            "  - Call out any important limitations of the libraryâ€™s SSH config support (e.g., mainly useful for ports or simple overrides).",
            "Step 8: Consider parity across similar components",
            "If there are multiple SSH runners or backends (e.g., Fabric and Paramiko-based runners), evaluate whether they should support a similar option for consistent user experience. Plan future work or file an issue if parity is desired but not yet implemented.",
            "Step 9: Validate in a real environment",
            "In a dev or staging environment, enable the option and verify that connections honor ~/.ssh/config for expected cases such as custom ports or host aliases. Confirm there are no regressions in default behavior when the option is left disabled."
        ]
    }
}