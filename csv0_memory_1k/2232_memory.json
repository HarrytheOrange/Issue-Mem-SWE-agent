{
    "search_index": {
        "description_for_embedding": "Test dependency betamax was upgraded from 0.5.1 to 0.7.0. The new version changed cassette behavior, requiring all recorded HTTP interaction cassettes (VCR files) to be deleted and re-recorded so that the test suite (run via tox/pytest) would pass again.",
        "keywords": [
            "betamax",
            "HTTP recording",
            "VCR cassettes",
            "test dependency upgrade",
            "pytest",
            "tox",
            "cassette re-recording",
            "home-assistant tests",
            "before_record hook",
            "before_playback hook"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this incident, the project upgraded its testing dependency betamax from version 0.5.1 to 0.7.0 by changing the pinned version in requirements_test.txt. Betamax is used to record and replay HTTP interactions as cassettes for the test suite. Initially, the author thought `tox` passed with the updated version, but it turned out that `tox` was still using betamax 0.5.1 locally. When betamax was truly upgraded to 0.7.0, existing recorded cassettes no longer matched the new library behavior and tests failed. The team recognized that betamax 0.7.0 introduced behavior changes (e.g., new hooks, different handling for duplicates and responses), making old cassettes incompatible or stale. The resolution was to delete the existing recorded VCR cassette files so that, on the next test run, betamax would re-record HTTP interactions with the new version. Another contributor performed this cleanup and re-recording, then committed the updated cassettes alongside the requirement bump, restoring a passing test suite.",
        "semantic_memory": "When upgrading libraries that record external interactions (e.g., betamax, vcrpy), existing recorded artifacts such as HTTP cassettes can become incompatible due to subtle behavior changes: new hooks, different matching semantics, or response object handling. This often manifests as previously passing tests failing after a dependency bump, even though the application logic is unchanged. A robust practice is to treat recorded fixtures (cassettes, snapshots, golden files) as version-coupled to the tooling that generated them. After upgrading such a tool, you should expect to regenerate those artifacts. Additionally, any claim that 'tests pass with the new version' must be verified in a clean environment to avoid accidentally testing against an older cached dependency. Pinning test dependencies and recording interfaces clearly in documentation helps future maintainers understand why fixture regeneration is necessary after certain upgrades.",
        "procedural_memory": [
            "When upgrading a test-time HTTP recording library (like betamax), expect existing cassettes/recorded fixtures to potentially break and plan to re-record them.",
            "Step 1: In a clean virtual environment, bump the pinned version of the recording library in the test requirements file (e.g., requirements_test.txt: change betamax==old to betamax==new).",
            "Step 2: Install dependencies fresh (e.g., recreate the virtualenv or run tox in a clean environment) to ensure you are actually using the new version of the library.",
            "Step 3: Run the test suite. If tests that rely on recorded HTTP interactions start failing, inspect errors for cassette mismatches, unexpected interaction counts, or serialization/format differences.",
            "Step 4: Delete the existing recorded cassette files (VCR/Betamax cassette directory) that correspond to the failing tests. In many setups this is a dedicated folder (e.g., tests/fixtures/cassettes or similar).",
            "Step 5: Re-run the tests that use those cassettes. The recording library will make real HTTP calls and generate new cassettes compatible with the upgraded version.",
            "Step 6: Verify that all tests now pass using the newly recorded cassettes and the new library version.",
            "Step 7: Commit both the requirement change (library version bump) and the regenerated cassette files together, so CI and other developers have consistent artifacts.",
            "Step 8: If the new library version introduces new hooks or options (e.g., before_record, before_playback, allow_playback_repeats), review and adjust configuration to ensure they are set appropriately before re-recording, to avoid needing another regeneration later.",
            "Step 9: Document in the contributor guidelines that when upgrading the HTTP recording library, cassettes may need to be regenerated, and indicate where those files live and how to do it."
        ]
    }
}