{
    "search_index": {
        "description_for_embedding": "Home Assistant Xiaomi Aqara binary_sensor did not support the WXKG02LM (b286acn01) dual switch double-both click event. The integration only mapped single, double, and both-clicks, but not the device’s 'double_both_click' payload. The fix added a mapping from the raw value 'double_both_click' to a new click_type 'double_both', enabling automations to trigger on a double-press of both buttons.",
        "keywords": [
            "Home Assistant",
            "xiaomi_aqara",
            "binary_sensor",
            "WXKG02LM",
            "b286acn01",
            "double_both_click",
            "double_both",
            "click_type",
            "event mapping",
            "device integration",
            "missing feature",
            "automation trigger"
        ]
    },
    "agent_memory": {
        "episodic_memory": "In this incident, a user discovered that the Home Assistant Xiaomi Aqara integration did not fully support all click types for the Xiaomi Aqara Wireless Wall Switch WXKG02LM, model b286acn01 (remote.b286acn01). While the device was capable of emitting an event for a double press on both buttons simultaneously, the integration only handled payloads such as 'single', 'double', 'both_click', 'shake', and 'long_click'. The device produced a raw zigbee/xiaomi value 'double_both_click', which was not recognized by the existing parse_data logic in homeassistant/components/binary_sensor/xiaomi_aqara.py. As a result, automations listening for xiaomi_aqara.click events could not use a 'double_both' click_type, even though the hardware supported it.\n\nThe fix was to extend the event parsing logic so that when the raw event value equals 'double_both_click', the code sets click_type to 'double_both'. This aligns with the existing naming convention (e.g., 'both_click' -> 'both') and exposes the new click_type through the xiaomi_aqara.click event. An example automation in configuration.yaml then uses:\n\n  event_type: xiaomi_aqara.click\n  event_data:\n    entity_id: binary_sensor.wall_switch_both_158d00027c19e9\n    click_type: double_both\n\nThe PR also included a related documentation update in the home-assistant.io repository to describe the new click_type. After this change, users of the b286acn01 dual switch can reliably trigger automations on a double press of both buttons, matching the device’s capabilities.",
        "semantic_memory": "This case shows a common integration issue: hardware supports more event types than the software mapping exposes. Many device integrations rely on translating low-level or vendor-specific payload values into higher-level, normalized event types used by automations. If a new firmware, hardware revision, or model introduces new payload values and they are not mapped, those capabilities effectively disappear from the user’s perspective.\n\nGeneral lessons:\n1. **Event mapping completeness**: For any device emitting symbolic events (click types, gestures, actions), ensure the integration maps all known payload values. Skipped or unrecognized values cause silent feature loss rather than obvious runtime errors.\n2. **Observe raw data first**: When users report “missing click type” or “unsupported action”, capture and inspect the raw device messages (e.g., Zigbee payloads, MQTT messages, or API responses) to see what exact values are sent.\n3. **Stable abstraction layer**: Translating device-specific strings (like 'double_both_click') into a consistent, user-facing vocabulary (like 'double_both') keeps automations decoupled from vendor quirks and makes documentation and examples more predictable.\n4. **Documentation alignment**: Whenever a new event/click_type is added, docs must be updated so users know they can rely on it in automations.\n5. **Backward compatibility**: Introducing new click types should not break existing ones; instead, it extends the existing mapping. Maintaining naming consistency ('both_click' -> 'both', 'double_both_click' -> 'double_both') improves discoverability and reduces confusion.\n\nOverall, the pattern is: when integrating event-driven devices, treat the mapping layer as a contract. Keep it comprehensive, tested, and documented, and revisit it when users report missing device behavior.",
        "procedural_memory": [
            "Step-by-step instructions on how to diagnose and fix similar issues.",
            "Step 1: Reproduce the missing behavior\n- Set up the device in a test or user environment.\n- Perform the action that is reportedly unsupported (e.g., double press both buttons on a dual switch).\n- Confirm that no expected automation triggers and/or that the integration doesn’t log a corresponding event.",
            "Step 2: Capture and inspect raw device events\n- Enable debug logging for the relevant integration (e.g., Xiaomi Aqara, Zigbee, MQTT).\n- Trigger the action again while logs are active.\n- Look for the raw payload in the logs (e.g., value: 'double_both_click').\n- Note the exact string or structure of the raw event field that represents the action.",
            "Step 3: Locate and review the event parsing code\n- Navigate to the integration’s event parsing module (here: homeassistant/components/binary_sensor/xiaomi_aqara.py).\n- Find the function or method that interprets the raw payload (e.g., parse_data(self, data, raw_data)).\n- Identify the existing mapping from raw payload values to internal event/click_type names (e.g., value == 'both_click' -> click_type = 'both').",
            "Step 4: Extend the mapping for new payload values\n- Add a new branch/condition to handle the missing raw payload value (e.g., 'double_both_click').\n- Map it to a consistent, user-facing click_type name (e.g., 'double_both'), following existing naming conventions.\n- Example:\n  elif value == 'double_both_click':\n      click_type = 'double_both'",
            "Step 5: Verify the change locally\n- Restart or reload the integration with the modified code.\n- Trigger the device action again.\n- Confirm that the integration now emits the expected normalized event (e.g., xiaomi_aqara.click with click_type: 'double_both').\n- Add or modify an automation that listens for this event and confirm it fires correctly.",
            "Step 6: Update documentation and examples\n- Add the new click_type or action to the integration’s documentation.\n- Provide a minimal example showing how to use the new type in configuration (e.g., configuration.yaml automation using click_type: double_both).\n- Ensure the docs’ naming matches the event mapping exactly.",
            "Step 7: Add or adjust tests if applicable\n- If the repository has tests for event parsing, add a test case covering the new payload value and expected click_type.\n- Run the test suite (e.g., tox) to validate that the change doesn’t break existing behavior.",
            "Step 8: Submit and review\n- Prepare a concise PR description summarizing: the missing device capability, the raw payload value, the new internal mapping, and any docs updates.\n- Respond to review feedback, especially about naming consistency, backward compatibility, and documentation clarity."
        ]
    }
}